<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fitting parametric survival models in R • flexsurvPlus</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Fitting parametric survival models in R">
<meta property="og:description" content="flexsurvPlus">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">flexsurvPlus</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Fitting_models_in_R.html">Fitting parametric survival models in R</a>
    </li>
    <li>
      <a href="../articles/Survival_analysis_theory.html">Parametric survival analysis using the flexsurvPlus package: understanding the theory</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Fitting_models_in_R_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="Fitting_models_in_R_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="Fitting_models_in_R_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Fitting parametric survival models in R</h1>
                        <h4 class="author">Roche</h4>
            
            <h4 class="date">2021-01-04</h4>
      
      
      <div class="hidden name"><code>Fitting_models_in_R.Rmd</code></div>

    </div>

    
    
<style type="text/css">

body{ /* Normal  */
      font-size: 14px;
  }
td {  /* Table  */
  font-size: 10px;
}
h1.title {
  font-size: 38px;
}
h1 { /* Header 1 */
  font-size: 28px;
  }
h2 { /* Header 2 */
    font-size: 22px;
}
h3 { /* Header 3 */
  font-size: 18px;
}
code.r{ /* Code block */
    font-size: 12px;
}
pre { /* Code block - determines code spacing between lines */
    font-size: 14px;
}
</style>
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>Parametric survival models are often the preferred method of extrapolating survival data for use in economic models. The National Institute for Health and Care Excellence (NICE) Decision Support Unit (DSU) technical support document (TSD) 14 recommends that the Exponential, Weibull, Gompertz, log-logistic, log normal and Generalized Gamma parametric models should all be considered.<span class="citation">[1]</span> More recently, NICE also discusses more flexible models in NICE DSU TSD 21, however, more these models are not in the scope of this package.<span class="citation">[2]</span> The Canadian Agency for Drugs and Technologies in Health (CADTH) additionally specifies that the Gamma distribution must also be considered. This document therefore details the characteristics of each of these distributions and demonstrates how the parameters from each distribution, outputted using the flexsurvPlus package, can be implemented within an economic model.<span class="citation">[3]</span></p>
<p>The flexsurvPlus package allows the inclusion of a treatment effect in the following three ways:</p>
<ul>
<li><p>Separate models - Models fitted to each treatment arm separately</p></li>
<li><p>Independent shape models - Models fitted to both/all treatment arms including a treatment covariate to model the effect of treatment on both the scale and shape parameter(s) of the distribution.</p></li>
<li><p>Common shape models - Models fitted to both/all treatment arms including a treatment covariate to model the effect of treatment on the scale parameter of the distribution. The shape parameter(s) of the distribution is common across treatments which reflects an assumption of proportional hazards or accelerated failure time between treatments depending on the distribution</p></li>
</ul>
<p>This document details how to use the <tt>flexsurvPlus</tt> package to perform these models. A separate vignette; “Parametric survival analysis using the flexsurvPlus package: understanding the theory” details the theory behind the models.</p>
</div>
<div id="set-up-packages-and-data" class="section level1">
<h1 class="hasAnchor">
<a href="#set-up-packages-and-data" class="anchor"></a>Set up packages and data</h1>
<div id="install-packages" class="section level2">
<h2 class="hasAnchor">
<a href="#install-packages" class="anchor"></a>Install packages</h2>
<p>The following packages are required to run this example:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">flexsurvPlus</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/">tibble</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival">survival</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.sthda.com/english/rpkgs/survminer/">survminer</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: ggplot2</span>
<span class="co">#&gt; Loading required package: ggpubr</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">boot</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'boot'</span>
<span class="co">#&gt; The following object is masked from 'package:survival':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     aml</span>


<span class="va">blue</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">69</span>, <span class="fl">185</span>, <span class="fl">209</span>, max<span class="op">=</span><span class="fl">255</span><span class="op">)</span>
<span class="va">red</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">225</span>, <span class="fl">55</span>, <span class="fl">60</span>, max<span class="op">=</span><span class="fl">255</span><span class="op">)</span>
<span class="va">yellow</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">238</span>, <span class="fl">224</span>, <span class="fl">30</span>, max<span class="op">=</span><span class="fl">255</span><span class="op">)</span>
<span class="va">pink</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">211</span>,<span class="fl">78</span>,<span class="fl">147</span>,max<span class="op">=</span><span class="fl">255</span><span class="op">)</span>
<span class="va">Dblue</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">45</span>,<span class="fl">92</span>,max<span class="op">=</span><span class="fl">255</span><span class="op">)</span>
<span class="va">Dyellow</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">214</span>, <span class="fl">200</span>, <span class="fl">16</span>, max<span class="op">=</span><span class="fl">255</span><span class="op">)</span>
<span class="va">green</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>
<span class="va">Dyellow</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">214</span>, <span class="fl">200</span>, <span class="fl">16</span>, max<span class="op">=</span><span class="fl">255</span><span class="op">)</span>
<span class="va">black</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,max<span class="op">=</span><span class="fl">255</span><span class="op">)</span>
<span class="va">grey1</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,max<span class="op">=</span><span class="fl">30</span><span class="op">)</span>
<span class="va">grey2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">10</span>,<span class="fl">10</span>,max<span class="op">=</span><span class="fl">30</span><span class="op">)</span>
<span class="va">grey3</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">20</span>,<span class="fl">20</span>,<span class="fl">20</span>,max<span class="op">=</span><span class="fl">30</span><span class="op">)</span>
<span class="va">grey3_dup</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">19</span>,<span class="fl">20</span>,<span class="fl">20</span>,max<span class="op">=</span><span class="fl">30</span><span class="op">)</span>
<span class="va">lightPink</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">229</span>,<span class="fl">151</span>,<span class="fl">192</span>,max<span class="op">=</span><span class="fl">255</span><span class="op">)</span>
<span class="va">orange</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">247</span>,<span class="fl">139</span>,<span class="fl">21</span>,max<span class="op">=</span><span class="fl">255</span><span class="op">)</span></code></pre></div>
</div>
<div id="read-in-the-data" class="section level2">
<h2 class="hasAnchor">
<a href="#read-in-the-data" class="anchor"></a>Read in the data</h2>
<p>To perform survival analyses, patient level data is required for the survival endpoints.</p>
<p>This example reads in a standard simulated data set (adtte) which is saved as a’.csv’ file. There is no standard naming that is needed for this package however, there are some set variables that are needed:</p>
<ul>
<li>Time - a numeric variable</li>
<li>Event - a binary variable (event=1, censor=0)</li>
<li>Treatment - a character variable with the name of the intervention treatment</li>
</ul>
<p>The data must be in “wide” format such that there is one row per patient and columns for each endpoint separately. In this example, we use overall survival (OS) and progression-free survival (PFS). The reference treatment is also set at the end of this chunk of code.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R">

<span class="va">adtte</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"adtte.csv"</span>, package <span class="op">=</span> <span class="st">"flexsurvPlus"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>


<span class="va">OS_data</span> <span class="op">&lt;-</span> <span class="va">adtte</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">PARAMCD</span><span class="op">==</span><span class="st">"OS"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>ARM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">ARM</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>OS_days <span class="op">=</span> <span class="va">AVAL</span>,
         OS_event <span class="op">=</span> <span class="va">EVNT</span>,
         OS_cens <span class="op">=</span> <span class="va">CNSR</span>
            <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">PARAMCD</span>, <span class="op">-</span><span class="va">PARAM</span><span class="op">)</span>

<span class="co"># subset PFS data and rename</span>
<span class="va">PFS_data</span> <span class="op">&lt;-</span> <span class="va">adtte</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">PARAMCD</span><span class="op">==</span><span class="st">"PFS"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>PFS_days <span class="op">=</span> <span class="va">AVAL</span>,
         PFS_event <span class="op">=</span> <span class="va">EVNT</span>,
         PFS_cens <span class="op">=</span> <span class="va">CNSR</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">PARAMCD</span>, <span class="op">-</span><span class="va">PARAM</span><span class="op">)</span>

<span class="va">analysis_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">OS_data</span>, <span class="va">PFS_data</span><span class="op">)</span>
<span class="co">#&gt; Joining, by = c("USUBJID", "ARM", "AVALU")</span>

<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">analysis_data</span><span class="op">$</span><span class="va">ARM</span><span class="op">)</span>
<span class="co">#&gt; NULL</span>
<span class="va">analysis_data</span><span class="op">$</span><span class="va">ARM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/relevel.html">relevel</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">analysis_data</span><span class="op">$</span><span class="va">ARM</span><span class="op">)</span>, ref<span class="op">=</span><span class="st">"B"</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="exploratory-analysis" class="section level1">
<h1 class="hasAnchor">
<a href="#exploratory-analysis" class="anchor"></a>Exploratory analysis</h1>
<p>Before performing any statistical analysis, it is important to explore the data.</p>
<p>Most importantly is a Kaplan-Meier plot and code to do this using <tt>ggsurvplot</tt> is presented below.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">km.est.OS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/survfit.html">survfit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span><span class="op">(</span><span class="va">OS_days</span>, <span class="va">OS_event</span><span class="op">)</span> <span class="op">~</span> <span class="va">ARM</span> , data <span class="op">=</span> <span class="va">analysis_data</span>, conf.type <span class="op">=</span> <span class="st">'plain'</span><span class="op">)</span>
<span class="va">km.est.PFS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/survfit.html">survfit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span><span class="op">(</span><span class="va">PFS_days</span>, <span class="va">PFS_event</span><span class="op">)</span> <span class="op">~</span> <span class="va">ARM</span> , data <span class="op">=</span> <span class="va">analysis_data</span>, conf.type <span class="op">=</span> <span class="st">'plain'</span><span class="op">)</span>

<span class="co">#KM_list &lt;- list(OS = km.est.OS, PFS = km.est.PFS)</span>

<span class="va">KM_plot_OS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survminer/man/ggsurvplot.html">ggsurvplot</a></span><span class="op">(</span><span class="va">km.est.OS</span>, risk.table <span class="op">=</span> <span class="cn">TRUE</span>, data <span class="op">=</span> <span class="va">analysis_data</span>,
           break.time.by <span class="op">=</span> <span class="fl">100</span>,
           conf.int <span class="op">=</span> <span class="cn">FALSE</span>,
           censor<span class="op">=</span><span class="cn">FALSE</span>,
           legend.title <span class="op">=</span> <span class="st">''</span>,
           xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">'Overall survival (Days)'</span><span class="op">)</span>,
           size <span class="op">=</span> <span class="fl">0.72</span>,
           xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">600</span><span class="op">)</span><span class="op">)</span>
<span class="va">KM_plot_OS</span></code></pre></div>
<p><img src="Fitting_models_in_R_files/figure-html/unnamed-chunk-3-1.png" width="672"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">KM_plot_PFS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survminer/man/ggsurvplot.html">ggsurvplot</a></span><span class="op">(</span><span class="va">km.est.PFS</span>, risk.table <span class="op">=</span> <span class="cn">TRUE</span>, data <span class="op">=</span> <span class="va">analysis_data</span>,
           break.time.by <span class="op">=</span> <span class="fl">100</span>,
           conf.int <span class="op">=</span> <span class="cn">FALSE</span>,
           censor<span class="op">=</span><span class="cn">FALSE</span>,
           legend.title <span class="op">=</span> <span class="st">''</span>,
           xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">'Progression-free survival (Days)'</span><span class="op">)</span>,
           size <span class="op">=</span> <span class="fl">0.72</span>,
           xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">600</span><span class="op">)</span><span class="op">)</span>
<span class="va">KM_plot_PFS</span></code></pre></div>
<p><img src="Fitting_models_in_R_files/figure-html/unnamed-chunk-3-2.png" width="672"></p>
</div>
<div id="fitting-the-models" class="section level1">
<h1 class="hasAnchor">
<a href="#fitting-the-models" class="anchor"></a>Fitting the models</h1>
<p>The <tt>runPSM</tt> function fits parametric survival models for multiple distributions using the <tt>flexsurv</tt> package (using the <tt>flexsurvPlus</tt> function <tt>fit_models</tt>), manipulates the flexsurv objects to get the parameter estimates and AIC and BIC value (using the <tt>flexsurvPlus</tt> function <tt>get_params</tt>) and rearranges the parameter estimates such that they can easily be output to excel to calculate survival for both the intervention and reference treatment in an economic model.</p>
<p>These functions can be used to estimate 3 types of model:</p>
<ul>
<li><p>Separate models - Models fitted to each treatment arm separately</p></li>
<li><p>Independent shape models - Models fitted to both/all treatment arms including a treatment covariate to model the effect of treatment on both the scale and shape parameter(s) of the distribution.</p></li>
<li><p>Common shape models - Models fitted to both/all treatment arms including a treatment covariate to model the effect of treatment on the scale parameter of the distribution. The shape parameter(s) of the distribution is common across treatments which reflects an assumption of proportional hazards or accelerated failure time between treatments depending on the distribution</p></li>
</ul>
<p>Each type of model can be fitted with a multiple distributions. The distributions available for this package are: * Exponential (‘exp’) * Weibull (‘weibull’) * Gompertz (‘gompertz’) * Log-normal (‘lnorm’) * Log-logistic (‘llogis’) * Generalized gamma (‘gengamma’) * Gamma (‘gamma’)</p>
<p>For more information on the different types of models, please see the survival analysis theory vignette included in the <tt>flexsurvPlus</tt> package.</p>
<p>The inputs to the <tt>runPSM</tt> function are: <em><tt>data</tt> - A data frame containing individual patient data for the relevant time to event outcomes </em><tt>time_var</tt> - Name of time variable in ‘data’. Variable must be numerical and &gt;0. <em><tt>event_var</tt> - Name of event variable in ‘data’. Variable must be numerical and contain 1’s to indicate an event and 0 to indicate a censor. </em><tt>model.type</tt> - Character vector indicating the type of model formula provided. Permitted values are ‘Common shape’, ‘Independent shape’ or ‘Separate’ as per the models explained above. <em><tt>strata_var</tt> - Name of stratification variable in “data”. This is usually the treatment variable and must be categorical. </em><tt>int_name</tt> - Character to indicate the name of the treatment of interest, must be a level of the “strata_var” column in “data”, used for labelling the parameters. *<tt>ref_name </tt> - Character to indicate the name of the reference treatment, must be a level of the “strata_var” column in “data”, used for labelling the parameters.</p>
<p>More information about each function can be used by running the code ?runPSM.</p>
<p>Example code for each type of model is presented below.</p>
<div id="separate-models-for-each-treatment" class="section level2">
<h2 class="hasAnchor">
<a href="#separate-models-for-each-treatment" class="anchor"></a>Separate models for each treatment</h2>
<p>These models have been fit using the <tt>runPSM</tt> function using the model.type=“Separate” argument.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">psm_OS_separate</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runPSM.html">runPSM</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">analysis_data</span>,
                          time_var<span class="op">=</span><span class="st">"OS_days"</span>,
                          event_var<span class="op">=</span><span class="st">"OS_event"</span>,
                          model.type<span class="op">=</span><span class="st">"Separate"</span>,
                          distr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'exp'</span>,
                                    <span class="st">'weibull'</span>,
                                    <span class="st">'gompertz'</span>,
                                    <span class="st">'lnorm'</span>,
                                    <span class="st">'llogis'</span>,
                                    <span class="st">'gengamma'</span>,
                                    <span class="st">'gamma'</span><span class="op">)</span>,
                          strata_var <span class="op">=</span> <span class="st">"ARM"</span>,
                          int_name<span class="op">=</span><span class="st">"A"</span>,
                          ref_name <span class="op">=</span> <span class="st">"B"</span><span class="op">)</span>
<span class="va">psm_OS_separate</span>
<span class="co">#&gt; $models.int</span>
<span class="co">#&gt; $models.int$exp</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; flexsurv::flexsurvreg(formula = model.formula, data = data, dist = dist)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimates: </span>
<span class="co">#&gt;       est       L95%      U95%      se      </span>
<span class="co">#&gt; rate  0.008854  0.007697  0.010184  0.000632</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; N = 300,  Events: 196,  Censored: 104</span>
<span class="co">#&gt; Total time at risk: 22137.48</span>
<span class="co">#&gt; Log-likelihood = -1122.475, df = 1</span>
<span class="co">#&gt; AIC = 2246.95</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $models.int$weibull</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; flexsurv::flexsurvreg(formula = model.formula, data = data, dist = dist)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimates: </span>
<span class="co">#&gt;        est       L95%      U95%      se      </span>
<span class="co">#&gt; shape    0.9876    0.8861    1.1007    0.0546</span>
<span class="co">#&gt; scale  112.9590   98.0285  130.1634    8.1704</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; N = 300,  Events: 196,  Censored: 104</span>
<span class="co">#&gt; Total time at risk: 22137.48</span>
<span class="co">#&gt; Log-likelihood = -1122.449, df = 2</span>
<span class="co">#&gt; AIC = 2248.898</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $models.int$gompertz</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; flexsurv::flexsurvreg(formula = model.formula, data = data, dist = dist)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimates: </span>
<span class="co">#&gt;        est        L95%       U95%       se       </span>
<span class="co">#&gt; shape  -0.001057  -0.002982   0.000867   0.000982</span>
<span class="co">#&gt; rate    0.009558   0.007874   0.011602   0.000945</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; N = 300,  Events: 196,  Censored: 104</span>
<span class="co">#&gt; Total time at risk: 22137.48</span>
<span class="co">#&gt; Log-likelihood = -1121.874, df = 2</span>
<span class="co">#&gt; AIC = 2247.747</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $models.int$lnorm</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; flexsurv::flexsurvreg(formula = model.formula, data = data, dist = dist)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimates: </span>
<span class="co">#&gt;          est     L95%    U95%    se    </span>
<span class="co">#&gt; meanlog  4.2379  4.0615  4.4142  0.0900</span>
<span class="co">#&gt; sdlog    1.3944  1.2608  1.5422  0.0716</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; N = 300,  Events: 196,  Censored: 104</span>
<span class="co">#&gt; Total time at risk: 22137.48</span>
<span class="co">#&gt; Log-likelihood = -1132.13, df = 2</span>
<span class="co">#&gt; AIC = 2268.26</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $models.int$llogis</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; flexsurv::flexsurvreg(formula = model.formula, data = data, dist = dist)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimates: </span>
<span class="co">#&gt;        est     L95%    U95%    se    </span>
<span class="co">#&gt; shape   1.335   1.189   1.499   0.079</span>
<span class="co">#&gt; scale  71.311  60.862  83.555   5.765</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; N = 300,  Events: 196,  Censored: 104</span>
<span class="co">#&gt; Total time at risk: 22137.48</span>
<span class="co">#&gt; Log-likelihood = -1123.932, df = 2</span>
<span class="co">#&gt; AIC = 2251.864</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $models.int$gengamma</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; flexsurv::flexsurvreg(formula = model.formula, data = data, dist = dist)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimates: </span>
<span class="co">#&gt;        est     L95%    U95%    se    </span>
<span class="co">#&gt; mu     4.6217  4.4013  4.8421  0.1125</span>
<span class="co">#&gt; sigma  1.0841  0.9316  1.2614  0.0838</span>
<span class="co">#&gt; Q      0.7761  0.4307  1.1214  0.1762</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; N = 300,  Events: 196,  Censored: 104</span>
<span class="co">#&gt; Total time at risk: 22137.48</span>
<span class="co">#&gt; Log-likelihood = -1121.698, df = 3</span>
<span class="co">#&gt; AIC = 2249.396</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $models.int$gamma</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; flexsurv::flexsurvreg(formula = model.formula, data = data, dist = dist)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimates: </span>
<span class="co">#&gt;        est      L95%     U95%     se     </span>
<span class="co">#&gt; shape  1.00359  0.85473  1.17837  0.08221</span>
<span class="co">#&gt; rate   0.00889  0.00698  0.01134  0.00110</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; N = 300,  Events: 196,  Censored: 104</span>
<span class="co">#&gt; Total time at risk: 22137.48</span>
<span class="co">#&gt; Log-likelihood = -1122.474, df = 2</span>
<span class="co">#&gt; AIC = 2248.948</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $models.ref</span>
<span class="co">#&gt; $models.ref$exp</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; flexsurv::flexsurvreg(formula = model.formula, data = data, dist = dist)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimates: </span>
<span class="co">#&gt;       est       L95%      U95%      se      </span>
<span class="co">#&gt; rate  0.002849  0.002472  0.003285  0.000207</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; N = 500,  Events: 190,  Censored: 310</span>
<span class="co">#&gt; Total time at risk: 66681.16</span>
<span class="co">#&gt; Log-likelihood = -1303.524, df = 1</span>
<span class="co">#&gt; AIC = 2609.048</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $models.ref$weibull</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; flexsurv::flexsurvreg(formula = model.formula, data = data, dist = dist)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimates: </span>
<span class="co">#&gt;        est       L95%      U95%      se      </span>
<span class="co">#&gt; shape    0.9915    0.8843    1.1118    0.0579</span>
<span class="co">#&gt; scale  352.7019  300.9995  413.2853   28.5253</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; N = 500,  Events: 190,  Censored: 310</span>
<span class="co">#&gt; Total time at risk: 66681.16</span>
<span class="co">#&gt; Log-likelihood = -1303.514, df = 2</span>
<span class="co">#&gt; AIC = 2611.027</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $models.ref$gompertz</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; flexsurv::flexsurvreg(formula = model.formula, data = data, dist = dist)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimates: </span>
<span class="co">#&gt;        est        L95%       U95%       se       </span>
<span class="co">#&gt; shape   0.000222  -0.001091   0.001534   0.000670</span>
<span class="co">#&gt; rate    0.002773   0.002232   0.003444   0.000307</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; N = 500,  Events: 190,  Censored: 310</span>
<span class="co">#&gt; Total time at risk: 66681.16</span>
<span class="co">#&gt; Log-likelihood = -1303.472, df = 2</span>
<span class="co">#&gt; AIC = 2610.944</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $models.ref$lnorm</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; flexsurv::flexsurvreg(formula = model.formula, data = data, dist = dist)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimates: </span>
<span class="co">#&gt;          est     L95%    U95%    se    </span>
<span class="co">#&gt; meanlog  5.5661  5.3576  5.7747  0.1064</span>
<span class="co">#&gt; sdlog    1.6573  1.4943  1.8381  0.0876</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; N = 500,  Events: 190,  Censored: 310</span>
<span class="co">#&gt; Total time at risk: 66681.16</span>
<span class="co">#&gt; Log-likelihood = -1315.832, df = 2</span>
<span class="co">#&gt; AIC = 2635.664</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $models.ref$llogis</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; flexsurv::flexsurvreg(formula = model.formula, data = data, dist = dist)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimates: </span>
<span class="co">#&gt;        est       L95%      U95%      se      </span>
<span class="co">#&gt; shape    1.1596    1.0318    1.3032    0.0691</span>
<span class="co">#&gt; scale  246.4563  207.0622  293.3452   21.9005</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; N = 500,  Events: 190,  Censored: 310</span>
<span class="co">#&gt; Total time at risk: 66681.16</span>
<span class="co">#&gt; Log-likelihood = -1307.21, df = 2</span>
<span class="co">#&gt; AIC = 2618.42</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $models.ref$gengamma</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; flexsurv::flexsurvreg(formula = model.formula, data = data, dist = dist)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimates: </span>
<span class="co">#&gt;        est    L95%   U95%   se   </span>
<span class="co">#&gt; mu     5.920  5.699  6.142  0.113</span>
<span class="co">#&gt; sigma  0.900  0.625  1.295  0.167</span>
<span class="co">#&gt; Q      1.218  0.556  1.879  0.337</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; N = 500,  Events: 190,  Censored: 310</span>
<span class="co">#&gt; Total time at risk: 66681.16</span>
<span class="co">#&gt; Log-likelihood = -1303.244, df = 3</span>
<span class="co">#&gt; AIC = 2612.487</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $models.ref$gamma</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; flexsurv::flexsurvreg(formula = model.formula, data = data, dist = dist)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimates: </span>
<span class="co">#&gt;        est      L95%     U95%     se     </span>
<span class="co">#&gt; shape  0.98177  0.84636  1.13884  0.07434</span>
<span class="co">#&gt; rate   0.00277  0.00210  0.00365  0.00039</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; N = 500,  Events: 190,  Censored: 310</span>
<span class="co">#&gt; Total time at risk: 66681.16</span>
<span class="co">#&gt; Log-likelihood = -1303.495, df = 2</span>
<span class="co">#&gt; AIC = 2610.989</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $model_summary.int</span>
<span class="co">#&gt; # A tibble: 7 x 5</span>
<span class="co">#&gt;   name     value      coef           AIC   BIC</span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;list&gt;     &lt;named list&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 exp      &lt;flxsrvrg&gt; &lt;dbl [1]&gt;    2247. 2251.</span>
<span class="co">#&gt; 2 weibull  &lt;flxsrvrg&gt; &lt;dbl [2]&gt;    2249. 2256.</span>
<span class="co">#&gt; 3 gompertz &lt;flxsrvrg&gt; &lt;dbl [2]&gt;    2248. 2255.</span>
<span class="co">#&gt; 4 lnorm    &lt;flxsrvrg&gt; &lt;dbl [2]&gt;    2268. 2276.</span>
<span class="co">#&gt; 5 llogis   &lt;flxsrvrg&gt; &lt;dbl [2]&gt;    2252. 2259.</span>
<span class="co">#&gt; 6 gengamma &lt;flxsrvrg&gt; &lt;dbl [3]&gt;    2249. 2261.</span>
<span class="co">#&gt; 7 gamma    &lt;flxsrvrg&gt; &lt;dbl [2]&gt;    2249. 2256.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $model_summary.ref</span>
<span class="co">#&gt; # A tibble: 7 x 5</span>
<span class="co">#&gt;   name     value      coef           AIC   BIC</span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;list&gt;     &lt;named list&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 exp      &lt;flxsrvrg&gt; &lt;dbl [1]&gt;    2609. 2613.</span>
<span class="co">#&gt; 2 weibull  &lt;flxsrvrg&gt; &lt;dbl [2]&gt;    2611. 2619.</span>
<span class="co">#&gt; 3 gompertz &lt;flxsrvrg&gt; &lt;dbl [2]&gt;    2611. 2619.</span>
<span class="co">#&gt; 4 lnorm    &lt;flxsrvrg&gt; &lt;dbl [2]&gt;    2636. 2644.</span>
<span class="co">#&gt; 5 llogis   &lt;flxsrvrg&gt; &lt;dbl [2]&gt;    2618. 2627.</span>
<span class="co">#&gt; 6 gengamma &lt;flxsrvrg&gt; &lt;dbl [3]&gt;    2612. 2625.</span>
<span class="co">#&gt; 7 gamma    &lt;flxsrvrg&gt; &lt;dbl [2]&gt;    2611. 2619.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $parameters</span>
<span class="co">#&gt;   exp.rate.A weibull.shape.A weibull.scale.A gompertz.shape.A gompertz.rate.A</span>
<span class="co">#&gt; 1  -4.726913     -0.01250381        4.727025     -0.001057369       -4.650395</span>
<span class="co">#&gt;   lnorm.meanlog.A lnorm.sdlog.A llogis.shape.A llogis.scale.A gengamma.mu.A</span>
<span class="co">#&gt; 1        4.237853     0.3324763      0.2887196       4.267055      4.621655</span>
<span class="co">#&gt;   gengamma.sigma.A gengamma.Q.A gamma.shape.A gamma.rate.A exp.rate.B</span>
<span class="co">#&gt; 1       0.08071703    0.7760696   0.003578753    -4.722481  -5.860654</span>
<span class="co">#&gt;   weibull.shape.B weibull.scale.B gompertz.shape.B gompertz.rate.B</span>
<span class="co">#&gt; 1    -0.008490743        5.865623     0.0002216508       -5.887958</span>
<span class="co">#&gt;   lnorm.meanlog.B lnorm.sdlog.B llogis.shape.B llogis.scale.B gengamma.mu.B</span>
<span class="co">#&gt; 1        5.566114     0.5051968       0.148048       5.507185      5.920452</span>
<span class="co">#&gt;   gengamma.sigma.B gengamma.Q.B gamma.shape.B gamma.rate.B    Model</span>
<span class="co">#&gt; 1       -0.1054668     1.217508   -0.01839982    -5.889741 separate</span>
<span class="co">#&gt;   Intervention name Reference name</span>
<span class="co">#&gt; 1                 A              B</span></code></pre></div>
</div>
<div id="independent-shape-models" class="section level2">
<h2 class="hasAnchor">
<a href="#independent-shape-models" class="anchor"></a>Independent shape models</h2>
<p>These models are similar to the separate model for each treatment as they allow all parameters to vary by treatment, however it is performed using 1 model for 2 treatments, rather than 2 models as above. They have been fit using the <tt>runPSM</tt> function using the model.type=“Independent shape” argument.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">psm_OS_ind_shape</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runPSM.html">runPSM</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">analysis_data</span>,
                            time_var<span class="op">=</span><span class="st">"OS_days"</span>,
                            event_var<span class="op">=</span><span class="st">"OS_event"</span>,
                            model.type<span class="op">=</span><span class="st">"Independent shape"</span>,
                            distr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span> <span class="st">'weibull'</span>,
                            <span class="st">'gompertz'</span>,
                            <span class="st">'lnorm'</span>,
                            <span class="st">'llogis'</span>,
                            <span class="st">'gengamma'</span>,
                            <span class="st">'gamma'</span><span class="op">)</span>,
                            strata_var <span class="op">=</span> <span class="st">"ARM"</span>,
                            int_name<span class="op">=</span><span class="st">"A"</span>,
                            ref_name <span class="op">=</span> <span class="st">"B"</span><span class="op">)</span>

<span class="va">psm_OS_ind_shape</span>
<span class="co">#&gt; $models</span>
<span class="co">#&gt; $models$weibull</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; flexsurv::flexsurvreg(formula = model.formula, data = data, dist = dist)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimates: </span>
<span class="co">#&gt;                data mean  est        L95%       U95%       se         exp(est) </span>
<span class="co">#&gt; shape                 NA    0.99155    0.88431    1.11179    0.05791         NA</span>
<span class="co">#&gt; scale                 NA  352.70192  300.99947  413.28526   28.52525         NA</span>
<span class="co">#&gt; ARMInt           0.37500   -1.13860   -1.35126   -0.92594    0.10850    0.32027</span>
<span class="co">#&gt; shape(ARMInt)    0.37500   -0.00401   -0.16170    0.15367    0.08045    0.99599</span>
<span class="co">#&gt;                L95%       U95%     </span>
<span class="co">#&gt; shape                 NA         NA</span>
<span class="co">#&gt; scale                 NA         NA</span>
<span class="co">#&gt; ARMInt           0.25891    0.39616</span>
<span class="co">#&gt; shape(ARMInt)    0.85070    1.16611</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; N = 800,  Events: 386,  Censored: 414</span>
<span class="co">#&gt; Total time at risk: 88818.65</span>
<span class="co">#&gt; Log-likelihood = -2425.963, df = 4</span>
<span class="co">#&gt; AIC = 4859.926</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $models$llogis</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; flexsurv::flexsurvreg(formula = model.formula, data = data, dist = dist)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimates: </span>
<span class="co">#&gt;                data mean  est       L95%      U95%      se        exp(est)</span>
<span class="co">#&gt; shape                NA     1.1595    1.0318    1.3031    0.0691        NA</span>
<span class="co">#&gt; scale                NA   246.4578  207.0629  293.3478   21.9010        NA</span>
<span class="co">#&gt; ARMInt           0.3750    -1.2401   -1.4756   -1.0047    0.1201    0.2893</span>
<span class="co">#&gt; shape(ARMInt)    0.3750     0.1407   -0.0239    0.3053    0.0840    1.1511</span>
<span class="co">#&gt;                L95%      U95%    </span>
<span class="co">#&gt; shape                NA        NA</span>
<span class="co">#&gt; scale                NA        NA</span>
<span class="co">#&gt; ARMInt           0.2286    0.3662</span>
<span class="co">#&gt; shape(ARMInt)    0.9764    1.3570</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; N = 800,  Events: 386,  Censored: 414</span>
<span class="co">#&gt; Total time at risk: 88818.65</span>
<span class="co">#&gt; Log-likelihood = -2431.142, df = 4</span>
<span class="co">#&gt; AIC = 4870.284</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $models$gompertz</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; flexsurv::flexsurvreg(formula = model.formula, data = data, dist = dist)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimates: </span>
<span class="co">#&gt;                data mean  est        L95%       U95%       se         exp(est) </span>
<span class="co">#&gt; shape                 NA   0.000233  -0.001079   0.001546   0.000670         NA</span>
<span class="co">#&gt; rate                  NA   0.002767   0.002227   0.003438   0.000306         NA</span>
<span class="co">#&gt; ARMInt          0.375000   1.241978   0.951092   1.532863   0.148414   3.462454</span>
<span class="co">#&gt; shape(ARMInt)   0.375000  -0.001306  -0.003636   0.001024   0.001189   0.998695</span>
<span class="co">#&gt;                L95%       U95%     </span>
<span class="co">#&gt; shape                 NA         NA</span>
<span class="co">#&gt; rate                  NA         NA</span>
<span class="co">#&gt; ARMInt          2.588534   4.631419</span>
<span class="co">#&gt; shape(ARMInt)   0.996371   1.001024</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; N = 800,  Events: 386,  Censored: 414</span>
<span class="co">#&gt; Total time at risk: 88818.65</span>
<span class="co">#&gt; Log-likelihood = -2425.346, df = 4</span>
<span class="co">#&gt; AIC = 4858.692</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $models$gamma</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; flexsurv::flexsurvreg(formula = model.formula, data = data, dist = dist)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimates: </span>
<span class="co">#&gt;                data mean  est       L95%      U95%      se        exp(est)</span>
<span class="co">#&gt; shape                NA    0.98232   0.84687   1.13943   0.07436        NA</span>
<span class="co">#&gt; rate                 NA    0.00277   0.00210   0.00365   0.00039        NA</span>
<span class="co">#&gt; ARMInt          0.37500    1.16528   0.79783   1.53273   0.18748   3.20682</span>
<span class="co">#&gt; shape(ARMInt)   0.37500    0.02106  -0.19757   0.23969   0.11155   1.02128</span>
<span class="co">#&gt;                L95%      U95%    </span>
<span class="co">#&gt; shape                NA        NA</span>
<span class="co">#&gt; rate                 NA        NA</span>
<span class="co">#&gt; ARMInt          2.22072   4.63079</span>
<span class="co">#&gt; shape(ARMInt)   0.82072   1.27085</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; N = 800,  Events: 386,  Censored: 414</span>
<span class="co">#&gt; Total time at risk: 88818.65</span>
<span class="co">#&gt; Log-likelihood = -2425.969, df = 4</span>
<span class="co">#&gt; AIC = 4859.937</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $models$lnorm</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; flexsurv::flexsurvreg(formula = model.formula, data = data, dist = dist)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimates: </span>
<span class="co">#&gt;                data mean  est      L95%     U95%     se       exp(est)  L95%   </span>
<span class="co">#&gt; meanlog             NA     5.5661   5.3576   5.7746   0.1064       NA        NA</span>
<span class="co">#&gt; sdlog               NA     1.6573   1.4943   1.8381   0.0876       NA        NA</span>
<span class="co">#&gt; ARMInt          0.3750    -1.3282  -1.6014  -1.0551   0.1394   0.2649    0.2016</span>
<span class="co">#&gt; sdlog(ARMInt)   0.3750    -0.1727  -0.3172  -0.0283   0.0737   0.8414    0.7282</span>
<span class="co">#&gt;                U95%   </span>
<span class="co">#&gt; meanlog             NA</span>
<span class="co">#&gt; sdlog               NA</span>
<span class="co">#&gt; ARMInt          0.3482</span>
<span class="co">#&gt; sdlog(ARMInt)   0.9721</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; N = 800,  Events: 386,  Censored: 414</span>
<span class="co">#&gt; Total time at risk: 88818.65</span>
<span class="co">#&gt; Log-likelihood = -2447.962, df = 4</span>
<span class="co">#&gt; AIC = 4903.924</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $models$gengamma</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; flexsurv::flexsurvreg(formula = model.formula, data = data, dist = dist)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimates: </span>
<span class="co">#&gt;                data mean  est     L95%    U95%    se      exp(est)  L95%  </span>
<span class="co">#&gt; mu                 NA      5.923   5.701   6.145   0.113      NA        NA</span>
<span class="co">#&gt; sigma              NA      0.895   0.620   1.293   0.168      NA        NA</span>
<span class="co">#&gt; Q                  NA      1.226   0.558   1.894   0.341      NA        NA</span>
<span class="co">#&gt; ARMInt          0.375     -1.301  -1.614  -0.988   0.160   0.272     0.199</span>
<span class="co">#&gt; sigma(ARMInt)   0.375      0.191  -0.206   0.589   0.203   1.211     0.814</span>
<span class="co">#&gt; Q(ARMInt)       0.375     -0.450  -1.202   0.302   0.384   0.638     0.301</span>
<span class="co">#&gt;                U95%  </span>
<span class="co">#&gt; mu                 NA</span>
<span class="co">#&gt; sigma              NA</span>
<span class="co">#&gt; Q                  NA</span>
<span class="co">#&gt; ARMInt          0.372</span>
<span class="co">#&gt; sigma(ARMInt)   1.802</span>
<span class="co">#&gt; Q(ARMInt)       1.353</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; N = 800,  Events: 386,  Censored: 414</span>
<span class="co">#&gt; Total time at risk: 88818.65</span>
<span class="co">#&gt; Log-likelihood = -2424.941, df = 6</span>
<span class="co">#&gt; AIC = 4861.882</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $model_summary</span>
<span class="co">#&gt; # A tibble: 6 x 5</span>
<span class="co">#&gt;   name     value      coef           AIC   BIC</span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;list&gt;     &lt;named list&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 weibull  &lt;flxsrvrg&gt; &lt;dbl [4]&gt;    4860. 4879.</span>
<span class="co">#&gt; 2 llogis   &lt;flxsrvrg&gt; &lt;dbl [4]&gt;    4870. 4889.</span>
<span class="co">#&gt; 3 gompertz &lt;flxsrvrg&gt; &lt;dbl [4]&gt;    4859. 4877.</span>
<span class="co">#&gt; 4 gamma    &lt;flxsrvrg&gt; &lt;dbl [4]&gt;    4860. 4879.</span>
<span class="co">#&gt; 5 lnorm    &lt;flxsrvrg&gt; &lt;dbl [4]&gt;    4904. 4923.</span>
<span class="co">#&gt; 6 gengamma &lt;flxsrvrg&gt; &lt;dbl [6]&gt;    4862. 4890.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $parameters</span>
<span class="co">#&gt;   weibull.scale.A weibull.scale.B weibull.shape.A weibull.shape.B</span>
<span class="co">#&gt; 1        4.727025        5.865623     -0.01250379    -0.008490745</span>
<span class="co">#&gt;   weibull.scale.TE weibull.shape.TE llogis.scale.A llogis.scale.B</span>
<span class="co">#&gt; 1        -1.138599     -0.004013049       4.267049       5.507191</span>
<span class="co">#&gt;   llogis.shape.A llogis.shape.B llogis.scale.TE llogis.shape.TE gompertz.rate.A</span>
<span class="co">#&gt; 1      0.2887151      0.1480288       -1.240142       0.1406863       -4.647951</span>
<span class="co">#&gt;   gompertz.rate.B gompertz.shape.A gompertz.shape.B gompertz.rate.TE</span>
<span class="co">#&gt; 1       -5.889928     -0.001072769     0.0002333335         1.241978</span>
<span class="co">#&gt;   gompertz.shape.TE gamma.rate.A gamma.rate.B gamma.shape.A gamma.shape.B</span>
<span class="co">#&gt; 1      -0.001306103    -4.723153    -5.888433   0.003218602   -0.01784041</span>
<span class="co">#&gt;   gamma.rate.TE gamma.shape.TE lnorm.meanlog.A lnorm.meanlog.B lnorm.sdlog.A</span>
<span class="co">#&gt; 1       1.16528     0.02105901        4.237851        5.566094     0.3324774</span>
<span class="co">#&gt;   lnorm.sdlog.B lnorm.meanlog.TE lnorm.sdlog.TE gengamma.mu.A gengamma.mu.B</span>
<span class="co">#&gt; 1     0.5051875        -1.328242     -0.1727101      4.621656      5.922727</span>
<span class="co">#&gt;   gengamma.sigma.A gengamma.sigma.B gengamma.Q.A gengamma.Q.B gengamma.mu.TE</span>
<span class="co">#&gt; 1       0.08071701       -0.1106458    0.7760713      1.22599      -1.301072</span>
<span class="co">#&gt;   gengamma.sigma.TE gengamma.Q.TE             Model Intervention name</span>
<span class="co">#&gt; 1         0.1913629    -0.4499184 Independent shape                 A</span>
<span class="co">#&gt;   Reference name</span>
<span class="co">#&gt; 1              B</span></code></pre></div>
</div>
<div id="fit-common-shape-models" class="section level2">
<h2 class="hasAnchor">
<a href="#fit-common-shape-models" class="anchor"></a>Fit common shape models</h2>
<p>These models have been fit using the <tt>runPSM</tt> function using the model.type=“Common shape” argument.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">psm_OS_common_shape</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runPSM.html">runPSM</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">analysis_data</span>,
                     time_var<span class="op">=</span><span class="st">"OS_days"</span>,
                     event_var<span class="op">=</span><span class="st">"OS_event"</span>,
                     model.type<span class="op">=</span><span class="st">"Common shape"</span>,
                     distr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'exp'</span>,
                               <span class="st">'weibull'</span>,
                               <span class="st">'gompertz'</span>,
                               <span class="st">'lnorm'</span>,
                               <span class="st">'llogis'</span>,
                               <span class="st">'gengamma'</span>,
                               <span class="st">'gamma'</span><span class="op">)</span>,
                     strata_var <span class="op">=</span> <span class="st">"ARM"</span>,
                     int_name<span class="op">=</span><span class="st">"A"</span>,
                     ref_name <span class="op">=</span> <span class="st">"B"</span><span class="op">)</span>
<span class="va">psm_OS_common_shape</span>
<span class="co">#&gt; $models</span>
<span class="co">#&gt; $models$exp</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; flexsurv::flexsurvreg(formula = model.formula, data = data, dist = dist)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimates: </span>
<span class="co">#&gt;         data mean  est       L95%      U95%      se        exp(est)  L95%    </span>
<span class="co">#&gt; rate          NA   0.002849  0.002472  0.003285  0.000207        NA        NA</span>
<span class="co">#&gt; ARMInt  0.375000   1.133741  0.934198  1.333284  0.101810  3.107259  2.545171</span>
<span class="co">#&gt;         U95%    </span>
<span class="co">#&gt; rate          NA</span>
<span class="co">#&gt; ARMInt  3.793481</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; N = 800,  Events: 386,  Censored: 414</span>
<span class="co">#&gt; Total time at risk: 88818.65</span>
<span class="co">#&gt; Log-likelihood = -2425.999, df = 2</span>
<span class="co">#&gt; AIC = 4855.998</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $models$weibull</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; flexsurv::flexsurvreg(formula = model.formula, data = data, dist = dist)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimates: </span>
<span class="co">#&gt;         data mean  est       L95%      U95%      se        exp(est)  L95%    </span>
<span class="co">#&gt; shape         NA     0.9894    0.9145    1.0705    0.0397        NA        NA</span>
<span class="co">#&gt; scale         NA   353.1438  303.6234  410.7410   27.2227        NA        NA</span>
<span class="co">#&gt; ARMInt    0.3750    -1.1399   -1.3467   -0.9331    0.1055    0.3199    0.2601</span>
<span class="co">#&gt;         U95%    </span>
<span class="co">#&gt; shape         NA</span>
<span class="co">#&gt; scale         NA</span>
<span class="co">#&gt; ARMInt    0.3933</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; N = 800,  Events: 386,  Censored: 414</span>
<span class="co">#&gt; Total time at risk: 88818.65</span>
<span class="co">#&gt; Log-likelihood = -2425.964, df = 3</span>
<span class="co">#&gt; AIC = 4857.928</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $models$gompertz</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; flexsurv::flexsurvreg(formula = model.formula, data = data, dist = dist)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimates: </span>
<span class="co">#&gt;         data mean  est        L95%       U95%       se         exp(est) </span>
<span class="co">#&gt; shape          NA  -0.000213  -0.001295   0.000869   0.000552         NA</span>
<span class="co">#&gt; rate           NA   0.002923   0.002411   0.003544   0.000287         NA</span>
<span class="co">#&gt; ARMInt   0.375000   1.124274   0.918752   1.329796   0.104860   3.077982</span>
<span class="co">#&gt;         L95%       U95%     </span>
<span class="co">#&gt; shape          NA         NA</span>
<span class="co">#&gt; rate           NA         NA</span>
<span class="co">#&gt; ARMInt   2.506160   3.780274</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; N = 800,  Events: 386,  Censored: 414</span>
<span class="co">#&gt; Total time at risk: 88818.65</span>
<span class="co">#&gt; Log-likelihood = -2425.926, df = 3</span>
<span class="co">#&gt; AIC = 4857.851</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $models$lnorm</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; flexsurv::flexsurvreg(formula = model.formula, data = data, dist = dist)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimates: </span>
<span class="co">#&gt;          data mean  est      L95%     U95%     se       exp(est)  L95%   </span>
<span class="co">#&gt; meanlog       NA     5.4852   5.3068   5.6636   0.0910       NA        NA</span>
<span class="co">#&gt; sdlog         NA     1.5274   1.4209   1.6419   0.0563       NA        NA</span>
<span class="co">#&gt; ARMInt    0.3750    -1.2088  -1.4614  -0.9562   0.1289   0.2985    0.2319</span>
<span class="co">#&gt;          U95%   </span>
<span class="co">#&gt; meanlog       NA</span>
<span class="co">#&gt; sdlog         NA</span>
<span class="co">#&gt; ARMInt    0.3843</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; N = 800,  Events: 386,  Censored: 414</span>
<span class="co">#&gt; Total time at risk: 88818.65</span>
<span class="co">#&gt; Log-likelihood = -2450.702, df = 3</span>
<span class="co">#&gt; AIC = 4907.404</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $models$llogis</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; flexsurv::flexsurvreg(formula = model.formula, data = data, dist = dist)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimates: </span>
<span class="co">#&gt;         data mean  est       L95%      U95%      se        exp(est)  L95%    </span>
<span class="co">#&gt; shape         NA     1.2408    1.1428    1.3471    0.0521        NA        NA</span>
<span class="co">#&gt; scale         NA   237.2853  202.7508  277.7020   19.0419        NA        NA</span>
<span class="co">#&gt; ARMInt    0.3750    -1.1882   -1.4147   -0.9617    0.1156    0.3048    0.2430</span>
<span class="co">#&gt;         U95%    </span>
<span class="co">#&gt; shape         NA</span>
<span class="co">#&gt; scale         NA</span>
<span class="co">#&gt; ARMInt    0.3822</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; N = 800,  Events: 386,  Censored: 414</span>
<span class="co">#&gt; Total time at risk: 88818.65</span>
<span class="co">#&gt; Log-likelihood = -2432.545, df = 3</span>
<span class="co">#&gt; AIC = 4871.089</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $models$gengamma</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; flexsurv::flexsurvreg(formula = model.formula, data = data, dist = dist)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimates: </span>
<span class="co">#&gt;         data mean  est      L95%     U95%     se       exp(est)  L95%   </span>
<span class="co">#&gt; mu           NA     5.8404   5.6625   6.0184   0.0908       NA        NA</span>
<span class="co">#&gt; sigma        NA     1.0439   0.9108   1.1965   0.0726       NA        NA</span>
<span class="co">#&gt; Q            NA     0.9212   0.6508   1.1917   0.1380       NA        NA</span>
<span class="co">#&gt; ARMInt   0.3750    -1.1500  -1.3618  -0.9381   0.1081   0.3166    0.2562</span>
<span class="co">#&gt;         U95%   </span>
<span class="co">#&gt; mu           NA</span>
<span class="co">#&gt; sigma        NA</span>
<span class="co">#&gt; Q            NA</span>
<span class="co">#&gt; ARMInt   0.3914</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; N = 800,  Events: 386,  Censored: 414</span>
<span class="co">#&gt; Total time at risk: 88818.65</span>
<span class="co">#&gt; Log-likelihood = -2425.806, df = 4</span>
<span class="co">#&gt; AIC = 4859.612</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $models$gamma</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; flexsurv::flexsurvreg(formula = model.formula, data = data, dist = dist)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimates: </span>
<span class="co">#&gt;         data mean  est       L95%      U95%      se        exp(est)  L95%    </span>
<span class="co">#&gt; shape         NA   0.991716  0.889305  1.105920  0.055151        NA        NA</span>
<span class="co">#&gt; rate          NA   0.002812  0.002248  0.003518  0.000321        NA        NA</span>
<span class="co">#&gt; ARMInt  0.375000   1.136564  0.932578  1.340550  0.104076  3.116043  2.541052</span>
<span class="co">#&gt;         U95%    </span>
<span class="co">#&gt; shape         NA</span>
<span class="co">#&gt; rate          NA</span>
<span class="co">#&gt; ARMInt  3.821144</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; N = 800,  Events: 386,  Censored: 414</span>
<span class="co">#&gt; Total time at risk: 88818.65</span>
<span class="co">#&gt; Log-likelihood = -2425.988, df = 3</span>
<span class="co">#&gt; AIC = 4857.976</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $model_summary</span>
<span class="co">#&gt; # A tibble: 7 x 5</span>
<span class="co">#&gt;   name     value      coef           AIC   BIC</span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;list&gt;     &lt;named list&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 exp      &lt;flxsrvrg&gt; &lt;dbl [2]&gt;    4856. 4865.</span>
<span class="co">#&gt; 2 weibull  &lt;flxsrvrg&gt; &lt;dbl [3]&gt;    4858. 4872.</span>
<span class="co">#&gt; 3 gompertz &lt;flxsrvrg&gt; &lt;dbl [3]&gt;    4858. 4872.</span>
<span class="co">#&gt; 4 lnorm    &lt;flxsrvrg&gt; &lt;dbl [3]&gt;    4907. 4921.</span>
<span class="co">#&gt; 5 llogis   &lt;flxsrvrg&gt; &lt;dbl [3]&gt;    4871. 4885.</span>
<span class="co">#&gt; 6 gengamma &lt;flxsrvrg&gt; &lt;dbl [4]&gt;    4860. 4878.</span>
<span class="co">#&gt; 7 gamma    &lt;flxsrvrg&gt; &lt;dbl [3]&gt;    4858. 4872.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $parameters</span>
<span class="co">#&gt;   exp.rate.A exp.rate.B exp.rate.TE weibull.scale.A weibull.scale.B</span>
<span class="co">#&gt; 1  -4.726913  -5.860654    1.133741        4.727001        5.866875</span>
<span class="co">#&gt;   weibull.shape.A weibull.shape.B weibull.scale.TE gompertz.rate.A</span>
<span class="co">#&gt; 1      -0.0106083      -0.0106083        -1.139875       -4.710777</span>
<span class="co">#&gt;   gompertz.rate.B gompertz.shape.A gompertz.shape.B gompertz.rate.TE</span>
<span class="co">#&gt; 1       -5.835051    -0.0002127812    -0.0002127812         1.124274</span>
<span class="co">#&gt;   llogis.scale.A llogis.scale.B llogis.shape.A llogis.shape.B llogis.scale.TE</span>
<span class="co">#&gt; 1       4.281024       5.469263      0.2157325      0.2157325       -1.188239</span>
<span class="co">#&gt;   gamma.rate.A gamma.rate.B gamma.shape.A gamma.shape.B gamma.rate.TE</span>
<span class="co">#&gt; 1    -4.737217    -5.873781   -0.00831878   -0.00831878      1.136564</span>
<span class="co">#&gt;   lnorm.meanlog.A lnorm.meanlog.B lnorm.sdlog.A lnorm.sdlog.B lnorm.meanlog.TE</span>
<span class="co">#&gt; 1        4.276408         5.48523     0.4235878     0.4235878        -1.208822</span>
<span class="co">#&gt;   gengamma.mu.A gengamma.mu.B gengamma.sigma.A gengamma.sigma.B gengamma.Q.A</span>
<span class="co">#&gt; 1      4.690469      5.840432       0.04296199       0.04296199    0.9212455</span>
<span class="co">#&gt;   gengamma.Q.B gengamma.mu.TE        Model Intervention name Reference name</span>
<span class="co">#&gt; 1    0.9212455      -1.149962 Common shape                 A              B</span></code></pre></div>
</div>
<div id="output-parameters-to-excel" class="section level2">
<h2 class="hasAnchor">
<a href="#output-parameters-to-excel" class="anchor"></a>Output parameters to excel</h2>
<p>Once all the models have been fit, they can be combined to output to excel such that there is 1 row per model.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">parameters_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span><span class="op">(</span><span class="va">psm_OS_ind_shape</span><span class="op">$</span><span class="va">parameters</span>, <span class="va">psm_OS_common_shape</span><span class="op">$</span><span class="va">parameters</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span><span class="op">(</span><span class="va">psm_OS_separate</span><span class="op">$</span><span class="va">parameters</span><span class="op">)</span> <span class="op">%&gt;%</span>
<span class="co"># Add meta data to add in details of analysis</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Study_name <span class="op">=</span> <span class="st">"Study ABC"</span>,
          Datacut <span class="op">=</span> <span class="st">"Final"</span>,
         Population <span class="op">=</span> <span class="st">"ITT"</span>,
         Endpoint <span class="op">=</span> <span class="st">"OS"</span>,
         Endpoint_def <span class="op">=</span> <span class="st">"NA"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co">#reorder columns</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="st">"Model"</span>, <span class="st">"Intervention name"</span>, <span class="st">"Reference name"</span>,
         <span class="va">Study_name</span>, <span class="va">Datacut</span>, <span class="va">Population</span>, <span class="va">Endpoint</span>, <span class="va">Endpoint_def</span>,
         <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"exp"</span><span class="op">)</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"weibull"</span><span class="op">)</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"gompertz"</span><span class="op">)</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"lnorm"</span><span class="op">)</span>,
         <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"llogis"</span><span class="op">)</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"gengamma"</span><span class="op">)</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"gamma"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">Model</span><span class="op">)</span>
<span class="co">#&gt; Joining, by = c("weibull.scale.A", "weibull.scale.B", "weibull.shape.A", "weibull.shape.B", "weibull.scale.TE", "llogis.scale.A", "llogis.scale.B", "llogis.shape.A", "llogis.shape.B", "llogis.scale.TE", "gompertz.rate.A", "gompertz.rate.B", "gompertz.shape.A", "gompertz.shape.B", "gompertz.rate.TE", "gamma.rate.A", "gamma.rate.B", "gamma.shape.A", "gamma.shape.B", "gamma.rate.TE", "lnorm.meanlog.A", "lnorm.meanlog.B", "lnorm.sdlog.A", "lnorm.sdlog.B", "lnorm.meanlog.TE", "gengamma.mu.A", "gengamma.mu.B", "gengamma.sigma.A", "gengamma.sigma.B", "gengamma.Q.A", "gengamma.Q.B", "gengamma.mu.TE", "Model", "Intervention name", "Reference name")</span>
<span class="co">#&gt; Joining, by = c("weibull.scale.A", "weibull.scale.B", "weibull.shape.A", "weibull.shape.B", "llogis.scale.A", "llogis.scale.B", "llogis.shape.A", "llogis.shape.B", "gompertz.rate.A", "gompertz.rate.B", "gompertz.shape.A", "gompertz.shape.B", "gamma.rate.A", "gamma.rate.B", "gamma.shape.A", "gamma.shape.B", "lnorm.meanlog.A", "lnorm.meanlog.B", "lnorm.sdlog.A", "lnorm.sdlog.B", "gengamma.mu.A", "gengamma.mu.B", "gengamma.sigma.A", "gengamma.sigma.B", "gengamma.Q.A", "gengamma.Q.B", "Model", "Intervention name", "Reference name", "exp.rate.A", "exp.rate.B")</span>

<span class="va">parameters_all</span>
<span class="co">#&gt;               Model Intervention name Reference name Study_name Datacut</span>
<span class="co">#&gt; 1      Common shape                 A              B  Study ABC   Final</span>
<span class="co">#&gt; 2 Independent shape                 A              B  Study ABC   Final</span>
<span class="co">#&gt; 3          separate                 A              B  Study ABC   Final</span>
<span class="co">#&gt;   Population Endpoint Endpoint_def exp.rate.A exp.rate.B exp.rate.TE</span>
<span class="co">#&gt; 1        ITT       OS           NA  -4.726913  -5.860654    1.133741</span>
<span class="co">#&gt; 2        ITT       OS           NA         NA         NA          NA</span>
<span class="co">#&gt; 3        ITT       OS           NA  -4.726913  -5.860654          NA</span>
<span class="co">#&gt;   weibull.scale.A weibull.scale.B weibull.shape.A weibull.shape.B</span>
<span class="co">#&gt; 1        4.727001        5.866875     -0.01060830    -0.010608303</span>
<span class="co">#&gt; 2        4.727025        5.865623     -0.01250379    -0.008490745</span>
<span class="co">#&gt; 3        4.727025        5.865623     -0.01250381    -0.008490743</span>
<span class="co">#&gt;   weibull.scale.TE weibull.shape.TE gompertz.rate.A gompertz.rate.B</span>
<span class="co">#&gt; 1        -1.139875               NA       -4.710777       -5.835051</span>
<span class="co">#&gt; 2        -1.138599     -0.004013049       -4.647951       -5.889928</span>
<span class="co">#&gt; 3               NA               NA       -4.650395       -5.887958</span>
<span class="co">#&gt;   gompertz.shape.A gompertz.shape.B gompertz.rate.TE gompertz.shape.TE</span>
<span class="co">#&gt; 1    -0.0002127812    -0.0002127812         1.124274                NA</span>
<span class="co">#&gt; 2    -0.0010727691     0.0002333335         1.241978      -0.001306103</span>
<span class="co">#&gt; 3    -0.0010573692     0.0002216508               NA                NA</span>
<span class="co">#&gt;   lnorm.meanlog.A lnorm.meanlog.B lnorm.sdlog.A lnorm.sdlog.B lnorm.meanlog.TE</span>
<span class="co">#&gt; 1        4.276408        5.485230     0.4235878     0.4235878        -1.208822</span>
<span class="co">#&gt; 2        4.237851        5.566094     0.3324774     0.5051875        -1.328242</span>
<span class="co">#&gt; 3        4.237853        5.566114     0.3324763     0.5051968               NA</span>
<span class="co">#&gt;   lnorm.sdlog.TE llogis.scale.A llogis.scale.B llogis.shape.A llogis.shape.B</span>
<span class="co">#&gt; 1             NA       4.281024       5.469263      0.2157325      0.2157325</span>
<span class="co">#&gt; 2     -0.1727101       4.267049       5.507191      0.2887151      0.1480288</span>
<span class="co">#&gt; 3             NA       4.267055       5.507185      0.2887196      0.1480480</span>
<span class="co">#&gt;   llogis.scale.TE llogis.shape.TE gengamma.mu.A gengamma.mu.B gengamma.sigma.A</span>
<span class="co">#&gt; 1       -1.188239              NA      4.690469      5.840432       0.04296199</span>
<span class="co">#&gt; 2       -1.240142       0.1406863      4.621656      5.922727       0.08071701</span>
<span class="co">#&gt; 3              NA              NA      4.621655      5.920452       0.08071703</span>
<span class="co">#&gt;   gengamma.sigma.B gengamma.Q.A gengamma.Q.B gengamma.mu.TE gengamma.sigma.TE</span>
<span class="co">#&gt; 1       0.04296199    0.9212455    0.9212455      -1.149962                NA</span>
<span class="co">#&gt; 2      -0.11064584    0.7760713    1.2259897      -1.301072         0.1913629</span>
<span class="co">#&gt; 3      -0.10546684    0.7760696    1.2175081             NA                NA</span>
<span class="co">#&gt;   gengamma.Q.TE gamma.rate.A gamma.rate.B gamma.shape.A gamma.shape.B</span>
<span class="co">#&gt; 1            NA    -4.737217    -5.873781  -0.008318780   -0.00831878</span>
<span class="co">#&gt; 2    -0.4499184    -4.723153    -5.888433   0.003218602   -0.01784041</span>
<span class="co">#&gt; 3            NA    -4.722481    -5.889741   0.003578753   -0.01839982</span>
<span class="co">#&gt;   gamma.rate.TE gamma.shape.TE</span>
<span class="co">#&gt; 1      1.136564             NA</span>
<span class="co">#&gt; 2      1.165280     0.02105901</span>
<span class="co">#&gt; 3            NA             NA</span>

<span class="co">#write.csv(parameters_all, "developing R code/params OS.csv")</span></code></pre></div>
</div>
</div>
<div id="estimate-survival-from-the-models-and-plot-the-curves" class="section level1">
<h1 class="hasAnchor">
<a href="#estimate-survival-from-the-models-and-plot-the-curves" class="anchor"></a>Estimate survival from the models and plot the curves</h1>
<p>Survival at a given time can be estimated using the <tt>get_curvefits</tt> function as shown below for treatment-effect models.</p>
<p>This can be used to cross check survival in excel models. The example is given below for the treatment-effect models.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Landmark survival</span>

<span class="va">curvefits_TEM_OS_landmark</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_curvefits.html">get_curvefits</a></span><span class="op">(</span>models <span class="op">=</span> <span class="va">psm_OS_common_shape</span><span class="op">$</span><span class="va">models</span>,
                                           time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span>, <span class="fl">200</span>, <span class="fl">300</span><span class="op">)</span><span class="op">)</span>
<span class="va">curvefits_df_TEM_OS_landmark</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="va">curvefits_TEM_OS_landmark</span><span class="op">$</span><span class="va">curvefits</span>, .id <span class="op">=</span> <span class="st">"Dist"</span><span class="op">)</span>  <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Dist</span>, <span class="va">ARM</span><span class="op">)</span>, values_from  <span class="op">=</span> <span class="va">est</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">curvefits_df_TEM_OS_landmark</span>
<span class="co">#&gt;   time   exp_Ref    exp_Int weibull_Ref weibull_Int gompertz_Ref gompertz_Int</span>
<span class="co">#&gt; 1    0 1.0000000 1.00000000   1.0000000  1.00000000    1.0000000   1.00000000</span>
<span class="co">#&gt; 2  100 0.7520608 0.41255895   0.7505372  0.41212147    0.7488330   0.41054348</span>
<span class="co">#&gt; 3  200 0.5655955 0.17020488   0.5656671  0.17205272    0.5641759   0.17173483</span>
<span class="co">#&gt; 4  300 0.4253622 0.07021955   0.4269982  0.07217507    0.4275954   0.07316887</span>
<span class="co">#&gt;   lnorm_Ref lnorm_Int llogis_Ref llogis_Int gengamma_Ref gengamma_Int gamma_Ref</span>
<span class="co">#&gt; 1 1.0000000 1.0000000  1.0000000  1.0000000    1.0000000   1.00000000 1.0000000</span>
<span class="co">#&gt; 2 0.7177497 0.4147906  0.7450039  0.4007861    0.7495611   0.40838244 0.7512597</span>
<span class="co">#&gt; 3 0.5486972 0.2517356  0.5528282  0.2205907    0.5638338   0.17452070 0.5657311</span>
<span class="co">#&gt; 4 0.4431115 0.1750247  0.4277628  0.1461258    0.4265918   0.07692335 0.4262962</span>
<span class="co">#&gt;    gamma_Int</span>
<span class="co">#&gt; 1 1.00000000</span>
<span class="co">#&gt; 2 0.41253541</span>
<span class="co">#&gt; 3 0.17111969</span>
<span class="co">#&gt; 4 0.07106512</span></code></pre></div>
<p>The <tt>get_curvefits</tt> function can also be used to generate the data required to plot the survival curves, overlaid on top of the KM plot. The time argument should reflect how long you want to the extrapolate for and the unit of time is the same as the input data (in this example, days).</p>
<p>The <tt>ggsurvplot</tt> function from the <tt>survminer</tt> package has been used to show how the survival curves can be plotted.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># Create data set for plots</span>
<span class="va">curvefits_TEM_OS</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_curvefits.html">get_curvefits</a></span><span class="op">(</span>models <span class="op">=</span> <span class="va">psm_OS_common_shape</span><span class="op">$</span><span class="va">models</span>,
                                  time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fl">0</span>, to <span class="op">=</span> <span class="fl">500</span>, by <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span>

<span class="co"># format data ready for the plot</span>
<span class="va">curvefits_df_TEM_OS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="va">curvefits_TEM_OS</span><span class="op">$</span><span class="va">curvefits</span>, .id <span class="op">=</span> <span class="st">"Dist"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ARM</span><span class="op">)</span>, values_from  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">est</span><span class="op">)</span><span class="op">)</span>

<span class="va">analysis_data_TrtA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">analysis_data</span>, <span class="va">ARM</span><span class="op">==</span><span class="st">"A"</span><span class="op">)</span>
<span class="va">analysis_data_TrtB</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">analysis_data</span>, <span class="va">ARM</span><span class="op">==</span><span class="st">"B"</span><span class="op">)</span>

<span class="co"># Get KM estimates</span>
<span class="va">km.est.OS.TrtA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/survfit.html">survfit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span><span class="op">(</span><span class="va">OS_days</span>, <span class="va">OS_event</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span> , data <span class="op">=</span> <span class="va">analysis_data_TrtA</span>, conf.type <span class="op">=</span> <span class="st">'plain'</span><span class="op">)</span>
<span class="va">km.est.OS.TrtB</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/survfit.html">survfit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span><span class="op">(</span><span class="va">OS_days</span>, <span class="va">OS_event</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span> , data <span class="op">=</span> <span class="va">analysis_data_TrtB</span>, conf.type <span class="op">=</span> <span class="st">'plain'</span><span class="op">)</span>


<span class="co"># Plot survival curves for arm A</span>
<span class="va">plot.OS.A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survminer/man/ggsurvplot.html">ggsurvplot</a></span><span class="op">(</span><span class="va">km.est.OS.TrtA</span>,
                        combine <span class="op">=</span> <span class="cn">TRUE</span>,
                        censor <span class="op">=</span> <span class="cn">FALSE</span>,
                        risk.table <span class="op">=</span> <span class="cn">TRUE</span>,
                        conf.int <span class="op">=</span> <span class="cn">FALSE</span>,
                        break.x.by <span class="op">=</span> <span class="fl">100</span>,
                        xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">500</span><span class="op">)</span>,
                        xlab <span class="op">=</span> <span class="st">"Time (days)"</span>,
                        size <span class="op">=</span> <span class="fl">0.72</span>,
                        linetype <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">6</span>,<span class="fl">6</span>,<span class="fl">6</span>,<span class="fl">6</span>, <span class="fl">1</span>, <span class="fl">6</span>, <span class="fl">6</span>,<span class="fl">6</span>,<span class="fl">6</span><span class="op">)</span>,
                        title  <span class="op">=</span>  <span class="st">'Kaplan-Meier of OS with standard distribution overlays'</span>,
                        legend.title <span class="op">=</span> <span class="st">''</span>,
                        legend.labs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"KM"</span><span class="op">)</span>,
                        surv.median.line <span class="op">=</span> <span class="st">'hv'</span>,
                        palette <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,max<span class="op">=</span><span class="fl">30</span><span class="op">)</span><span class="op">)</span>,
                        risk.table.y.text.col <span class="op">=</span> <span class="cn">F</span>
<span class="op">)</span>


<span class="va">plot.OS.A</span><span class="op">$</span><span class="va">plot</span> <span class="op">&lt;-</span> <span class="va">plot.OS.A</span><span class="op">$</span><span class="va">plot</span> <span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">Int</span>,
                colour <span class="op">=</span> <span class="va">Dist</span>,
                linetype <span class="op">=</span> <span class="va">Dist</span><span class="op">)</span>,
            size <span class="op">=</span> <span class="fl">0.72</span>,
            data <span class="op">=</span> <span class="va">curvefits_df_TEM_OS</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">blue</span>, <span class="va">pink</span>, <span class="va">Dyellow</span>, <span class="va">orange</span>, <span class="va">grey1</span>, <span class="va">lightPink</span>, <span class="va">red</span>, <span class="va">Dblue</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Scale for 'colour' is already present. Adding another scale for 'colour',</span>
<span class="co">#&gt; which will replace the existing scale.</span>

<span class="va">plot.OS.A</span></code></pre></div>
<p><img src="Fitting_models_in_R_files/figure-html/unnamed-chunk-9-1.png" width="672"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># Plot survival curves for arm B</span>
<span class="va">plot.OS.B</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survminer/man/ggsurvplot.html">ggsurvplot</a></span><span class="op">(</span><span class="va">km.est.OS.TrtB</span>,
                        combine <span class="op">=</span> <span class="cn">TRUE</span>,
                        censor <span class="op">=</span> <span class="cn">FALSE</span>,
                        risk.table <span class="op">=</span> <span class="cn">TRUE</span>,
                        conf.int <span class="op">=</span> <span class="cn">FALSE</span>,
                        break.x.by <span class="op">=</span> <span class="fl">100</span>,
                        xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">500</span><span class="op">)</span>,
                        xlab <span class="op">=</span> <span class="st">"Time (days)"</span>,
                        size <span class="op">=</span> <span class="fl">0.72</span>,
                        linetype <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">6</span>,<span class="fl">6</span>,<span class="fl">6</span>,<span class="fl">6</span>, <span class="fl">1</span>, <span class="fl">6</span>, <span class="fl">6</span>,<span class="fl">6</span>,<span class="fl">6</span><span class="op">)</span>,
                        title  <span class="op">=</span>  <span class="st">'Kaplan-Meier of OS with standard distribution overlays'</span>,
                        legend.title <span class="op">=</span> <span class="st">''</span>,
                        legend.labs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"KM"</span><span class="op">)</span>,
                        surv.median.line <span class="op">=</span> <span class="st">'hv'</span>,
                        palette <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,max<span class="op">=</span><span class="fl">30</span><span class="op">)</span><span class="op">)</span>,
                        risk.table.y.text.col <span class="op">=</span> <span class="cn">F</span>
<span class="op">)</span>


<span class="va">plot.OS.B</span><span class="op">$</span><span class="va">plot</span> <span class="op">&lt;-</span> <span class="va">plot.OS.B</span><span class="op">$</span><span class="va">plot</span> <span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">Ref</span>,
                colour <span class="op">=</span> <span class="va">Dist</span>,
                linetype <span class="op">=</span> <span class="va">Dist</span><span class="op">)</span>,
            size <span class="op">=</span> <span class="fl">0.72</span>,
            data <span class="op">=</span> <span class="va">curvefits_df_TEM_OS</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">blue</span>, <span class="va">pink</span>, <span class="va">Dyellow</span>, <span class="va">orange</span>, <span class="va">grey1</span>, <span class="va">lightPink</span>, <span class="va">red</span>, <span class="va">Dblue</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Scale for 'colour' is already present. Adding another scale for 'colour',</span>
<span class="co">#&gt; which will replace the existing scale.</span>

<span class="va">plot.OS.B</span></code></pre></div>
<p><img src="Fitting_models_in_R_files/figure-html/unnamed-chunk-9-2.png" width="672"></p>
</div>
<div id="bootstrapping" class="section level1">
<h1 class="hasAnchor">
<a href="#bootstrapping" class="anchor"></a>Bootstrapping</h1>
<p>Bootstrapping has been used to estimate the uncertainty of the parameters from the survival models for multiple endpoints at once to preserve the correlation between endpoints. In this example we have used OS and PFS.</p>
<p>Bootstrapping involves:</p>
<ol style="list-style-type: decimal">
<li>Sampling, with replacement, from all patients</li>
<li>Estimating all specified parametric survival models</li>
</ol>
<p>This procedure is repeated multiple times to obtain a distribution of parameters. For this example, bootstrap estimates of the parameters were calculated using the <tt>boot</tt> package. An argument for the <tt>boot</tt> function is <tt>statistic</tt> which is a function which when applied to data returns a vector containing the statistic(s) of interest. The <tt>bootPSM</tt> function in the <tt>flexsurvPlus</tt> package can be used for this purpose.</p>
<p>The inputs for the <tt>bootPSM</tt> function are very similar to the <tt>runPSM</tt> function, however there are a few additional arguments: <em><tt>endpoint1</tt> - Character to indicate the name of the first endpoint, used for labelling. </em><tt>endpoint2</tt> - Character to indicate the name of the second endpoint, used for labelling. <em><tt>time_var2</tt> - Name of time variable in ‘data’ of second endpoint. Variable must be numerical and &gt;0. </em><tt>event_var2</tt> - Name of event variable in ‘data’ of second endpoint. Variable must be numerical and contain 1’s to indicate an event and 0 to indicate a censor *<tt>i</tt> - Index used to select a sample within <tt>boot</tt></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">2358</span><span class="op">)</span>
<span class="va">n.sim</span> <span class="op">&lt;-</span> <span class="fl">100</span>
<span class="va">PSM_bootstraps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/boot/man/boot.html">boot</a></span><span class="op">(</span>
                 statistic <span class="op">=</span> <span class="va">bootPSM</span>, <span class="co"># bootstrap the HR (defined in the MAIC package)</span>
                      R<span class="op">=</span><span class="va">n.sim</span>, <span class="co"># number of bootstrap samples</span>
                      data<span class="op">=</span><span class="va">analysis_data</span>,
                      endpoint1 <span class="op">=</span> <span class="st">"OS"</span>,
                      endpoint2 <span class="op">=</span> <span class="st">"PFS"</span>,
                      time_var<span class="op">=</span><span class="st">"OS_days"</span>,
                      event_var<span class="op">=</span><span class="st">"OS_event"</span>,
                      time_var2<span class="op">=</span><span class="st">"PFS_days"</span>,
                      event_var2<span class="op">=</span><span class="st">"PFS_event"</span>,
                      model.type<span class="op">=</span><span class="st">"Common shape"</span>,
                      distr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'exp'</span>,
                                <span class="st">'weibull'</span>,
                                <span class="st">'gompertz'</span>,
                                <span class="st">'lnorm'</span>,
                                <span class="st">'llogis'</span>,
                                <span class="st">'gengamma'</span>,
                                <span class="st">'gamma'</span><span class="op">)</span>,
                      strata_var <span class="op">=</span> <span class="st">"ARM"</span>,
                      int_name<span class="op">=</span><span class="st">"A"</span>,
                      ref_name <span class="op">=</span> <span class="st">"B"</span>
<span class="op">)</span>
<span class="co">#&gt; Warning in log(pmax - pmin): NaNs produced</span>


<span class="va">PSM_boot_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">PSM_bootstraps</span><span class="op">$</span><span class="va">t</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">PSM_boot_data</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">PSM_bootstraps</span><span class="op">$</span><span class="va">t0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">PSM_boot_data</span><span class="op">)</span>
<span class="co">#&gt;   exp.rate.A.OS exp.rate.B.OS exp.rate.TE.OS weibull.scale.A.OS</span>
<span class="co">#&gt; 1     -4.674186     -5.845196       1.171010           4.673623</span>
<span class="co">#&gt; 2     -4.797600     -5.876173       1.078573           4.797855</span>
<span class="co">#&gt; 3     -4.709752     -5.849883       1.140131           4.709715</span>
<span class="co">#&gt; 4     -4.770941     -5.847381       1.076440           4.772141</span>
<span class="co">#&gt; 5     -4.625548     -5.777646       1.152098           4.622378</span>
<span class="co">#&gt; 6     -4.684654     -6.053826       1.369171           4.684643</span>
<span class="co">#&gt;   weibull.scale.B.OS weibull.shape.A.OS weibull.shape.B.OS weibull.scale.TE.OS</span>
<span class="co">#&gt; 1           5.851546      -0.0113801573      -0.0113801573           -1.177923</span>
<span class="co">#&gt; 2           5.878513      -0.0041326024      -0.0041326024           -1.080659</span>
<span class="co">#&gt; 3           5.850416      -0.0008988682      -0.0008988682           -1.140701</span>
<span class="co">#&gt; 4           5.865741      -0.0311017803      -0.0311017803           -1.093599</span>
<span class="co">#&gt; 5           5.793506      -0.0287043047      -0.0287043047           -1.171128</span>
<span class="co">#&gt; 6           6.055925      -0.0028474425      -0.0028474425           -1.371282</span>
<span class="co">#&gt;   gompertz.rate.A.OS gompertz.rate.B.OS gompertz.shape.A.OS gompertz.shape.B.OS</span>
<span class="co">#&gt; 1          -4.633602          -5.785439       -5.115336e-04       -5.115336e-04</span>
<span class="co">#&gt; 2          -4.774011          -5.836169       -3.222387e-04       -3.222387e-04</span>
<span class="co">#&gt; 3          -4.646541          -5.758642       -8.156143e-04       -8.156143e-04</span>
<span class="co">#&gt; 4          -4.739266          -5.797693       -4.161657e-04       -4.161657e-04</span>
<span class="co">#&gt; 5          -4.584187          -5.716000       -5.437789e-04       -5.437789e-04</span>
<span class="co">#&gt; 6          -4.686864          -6.059226        3.943243e-05        3.943243e-05</span>
<span class="co">#&gt;   gompertz.rate.TE.OS llogis.scale.A.OS llogis.scale.B.OS llogis.shape.A.OS</span>
<span class="co">#&gt; 1            1.151837          4.216291          5.426728         0.2354454</span>
<span class="co">#&gt; 2            1.062158          4.424318          5.453127         0.2039985</span>
<span class="co">#&gt; 3            1.112101          4.230947          5.427345         0.2558971</span>
<span class="co">#&gt; 4            1.058427          4.324373          5.462790         0.1923442</span>
<span class="co">#&gt; 5            1.131813          4.123716          5.381890         0.2283585</span>
<span class="co">#&gt; 6            1.372362          4.257061          5.676466         0.2139283</span>
<span class="co">#&gt;   llogis.shape.B.OS llogis.scale.TE.OS gamma.rate.A.OS gamma.rate.B.OS</span>
<span class="co">#&gt; 1         0.2354454          -1.210437       -4.674427       -5.845509</span>
<span class="co">#&gt; 2         0.2039985          -1.028808       -4.811046       -5.893516</span>
<span class="co">#&gt; 3         0.2558971          -1.196397       -4.677378       -5.807942</span>
<span class="co">#&gt; 4         0.1923442          -1.138417       -4.819613       -5.908604</span>
<span class="co">#&gt; 5         0.2283585          -1.258174       -4.654605       -5.814336</span>
<span class="co">#&gt; 6         0.2139283          -1.419405       -4.693072       -6.065313</span>
<span class="co">#&gt;   gamma.shape.A.OS gamma.shape.B.OS gamma.rate.TE.OS lnorm.meanlog.A.OS</span>
<span class="co">#&gt; 1    -0.0001992957    -0.0001992957         1.171082           4.225725</span>
<span class="co">#&gt; 2    -0.0108939669    -0.0108939669         1.082470           4.450174</span>
<span class="co">#&gt; 3     0.0265876303     0.0265876303         1.130564           4.211791</span>
<span class="co">#&gt; 4    -0.0386295461    -0.0386295461         1.088991           4.307436</span>
<span class="co">#&gt; 5    -0.0241227036    -0.0241227036         1.159730           4.122632</span>
<span class="co">#&gt; 6    -0.0068491605    -0.0068491605         1.372241           4.247357</span>
<span class="co">#&gt;   lnorm.meanlog.B.OS lnorm.sdlog.A.OS lnorm.sdlog.B.OS lnorm.meanlog.TE.OS</span>
<span class="co">#&gt; 1           5.422150        0.3894306        0.3894306          -1.1964246</span>
<span class="co">#&gt; 2           5.432125        0.4302597        0.4302597          -0.9819511</span>
<span class="co">#&gt; 3           5.460049        0.3536166        0.3536166          -1.2482576</span>
<span class="co">#&gt; 4           5.503186        0.4558107        0.4558107          -1.1957498</span>
<span class="co">#&gt; 5           5.381795        0.4067877        0.4067877          -1.2591633</span>
<span class="co">#&gt; 6           5.723877        0.4563993        0.4563993          -1.4765197</span>
<span class="co">#&gt;   gengamma.mu.A.OS gengamma.mu.B.OS gengamma.sigma.A.OS gengamma.sigma.B.OS</span>
<span class="co">#&gt; 1         4.581333         5.777217          0.08475410          0.08475410</span>
<span class="co">#&gt; 2         4.829137         5.908092         -0.03151651         -0.03151651</span>
<span class="co">#&gt; 3         4.528099         5.713744          0.13486293          0.13486293</span>
<span class="co">#&gt; 4         4.751456         5.850782          0.04986754          0.04986754</span>
<span class="co">#&gt; 5         4.530926         5.729768          0.09485584          0.09485584</span>
<span class="co">#&gt; 6         4.699289         6.065552         -0.01036524         -0.01036524</span>
<span class="co">#&gt;   gengamma.Q.A.OS gengamma.Q.B.OS gengamma.mu.TE.OS exp.rate.A.PFS</span>
<span class="co">#&gt; 1       0.8060359       0.8060359         -1.195884      -4.624417</span>
<span class="co">#&gt; 2       1.0820805       1.0820805         -1.078955      -4.623399</span>
<span class="co">#&gt; 3       0.6326642       0.6326642         -1.185646      -4.535589</span>
<span class="co">#&gt; 4       0.9550772       0.9550772         -1.099326      -4.562457</span>
<span class="co">#&gt; 5       0.8233485       0.8233485         -1.198842      -4.611087</span>
<span class="co">#&gt; 6       1.0316204       1.0316204         -1.366264      -4.412868</span>
<span class="co">#&gt;   exp.rate.B.PFS exp.rate.TE.PFS weibull.scale.A.PFS weibull.scale.B.PFS</span>
<span class="co">#&gt; 1      -5.212503       0.5880860            4.295979            5.500094</span>
<span class="co">#&gt; 2      -5.224586       0.6011863            4.328940            5.406693</span>
<span class="co">#&gt; 3      -5.199699       0.6641098            4.136033            5.438278</span>
<span class="co">#&gt; 4      -5.133587       0.5711299            4.307231            5.330423</span>
<span class="co">#&gt; 5      -5.227474       0.6163864            4.358169            5.415039</span>
<span class="co">#&gt; 6      -5.253070       0.8402011            3.864199            5.664195</span>
<span class="co">#&gt;   weibull.shape.A.PFS weibull.shape.B.PFS weibull.scale.TE.PFS</span>
<span class="co">#&gt; 1          -0.5356830          -0.5356830            -1.204115</span>
<span class="co">#&gt; 2          -0.5034836          -0.5034836            -1.077753</span>
<span class="co">#&gt; 3          -0.5792022          -0.5792022            -1.302246</span>
<span class="co">#&gt; 4          -0.4524836          -0.4524836            -1.023192</span>
<span class="co">#&gt; 5          -0.4625372          -0.4625372            -1.056870</span>
<span class="co">#&gt; 6          -0.6904711          -0.6904711            -1.799996</span>
<span class="co">#&gt;   gompertz.rate.A.PFS gompertz.rate.B.PFS gompertz.shape.A.PFS</span>
<span class="co">#&gt; 1           -4.381367           -5.016474         -0.002323964</span>
<span class="co">#&gt; 2           -4.437016           -5.044155         -0.001852966</span>
<span class="co">#&gt; 3           -4.268251           -4.956009         -0.002637671</span>
<span class="co">#&gt; 4           -4.401318           -4.994509         -0.001675125</span>
<span class="co">#&gt; 5           -4.466671           -5.089872         -0.001467683</span>
<span class="co">#&gt; 6           -4.149004           -5.014964         -0.002785059</span>
<span class="co">#&gt;   gompertz.shape.B.PFS gompertz.rate.TE.PFS llogis.scale.A.PFS</span>
<span class="co">#&gt; 1         -0.002323964            0.6351069           3.499713</span>
<span class="co">#&gt; 2         -0.001852966            0.6071388           3.571036</span>
<span class="co">#&gt; 3         -0.002637671            0.6877575           3.232364</span>
<span class="co">#&gt; 4         -0.001675125            0.5931911           3.624396</span>
<span class="co">#&gt; 5         -0.001467683            0.6232004           3.681459</span>
<span class="co">#&gt; 6         -0.002785059            0.8659600           2.668471</span>
<span class="co">#&gt;   llogis.scale.B.PFS llogis.shape.A.PFS llogis.shape.B.PFS llogis.scale.TE.PFS</span>
<span class="co">#&gt; 1           5.046183         -0.3697310         -0.3697310           -1.546470</span>
<span class="co">#&gt; 2           4.929737         -0.3393161         -0.3393161           -1.358700</span>
<span class="co">#&gt; 3           4.948169         -0.4092871         -0.4092871           -1.715805</span>
<span class="co">#&gt; 4           4.879570         -0.2818601         -0.2818601           -1.255174</span>
<span class="co">#&gt; 5           4.954387         -0.2982552         -0.2982552           -1.272928</span>
<span class="co">#&gt; 6           5.217677         -0.5354050         -0.5354050           -2.549206</span>
<span class="co">#&gt;   gamma.rate.A.PFS gamma.rate.B.PFS gamma.shape.A.PFS gamma.shape.B.PFS</span>
<span class="co">#&gt; 1        -5.369388        -6.385789        -0.7339526        -0.7339526</span>
<span class="co">#&gt; 2        -5.330225        -6.274243        -0.7013316        -0.7013316</span>
<span class="co">#&gt; 3        -5.325234        -6.404572        -0.7866457        -0.7866457</span>
<span class="co">#&gt; 4        -5.210436        -6.122085        -0.6456307        -0.6456307</span>
<span class="co">#&gt; 5        -5.273641        -6.226752        -0.6578415        -0.6578415</span>
<span class="co">#&gt; 6        -5.318286        -6.709135        -0.8977908        -0.8977908</span>
<span class="co">#&gt;   gamma.rate.TE.PFS lnorm.meanlog.A.PFS lnorm.meanlog.B.PFS lnorm.sdlog.A.PFS</span>
<span class="co">#&gt; 1         1.0164008            2.668089            5.362222         1.0608771</span>
<span class="co">#&gt; 2         0.9440176            2.721691            5.172227         1.0242061</span>
<span class="co">#&gt; 3         1.0793373            2.424389            5.184661         1.0474285</span>
<span class="co">#&gt; 4         0.9116486            2.808905            5.164204         0.9922453</span>
<span class="co">#&gt; 5         0.9531106            2.885349            5.208277         0.9947624</span>
<span class="co">#&gt; 6         1.3908495            1.851255            5.463581         1.1496797</span>
<span class="co">#&gt;   lnorm.sdlog.B.PFS lnorm.meanlog.TE.PFS gengamma.mu.A.PFS gengamma.mu.B.PFS</span>
<span class="co">#&gt; 1         1.0608771            -2.694133          5.113837          5.850417</span>
<span class="co">#&gt; 2         1.0242061            -2.450536          5.185129          5.871196</span>
<span class="co">#&gt; 3         1.0474285            -2.760272          5.200495          5.923405</span>
<span class="co">#&gt; 4         0.9922453            -2.355300          5.089272          5.738867</span>
<span class="co">#&gt; 5         0.9947624            -2.322928          5.164256          5.853456</span>
<span class="co">#&gt; 6         1.1496797            -3.612326          5.045563          6.014894</span>
<span class="co">#&gt;   gengamma.sigma.A.PFS gengamma.sigma.B.PFS gengamma.Q.A.PFS gengamma.Q.B.PFS</span>
<span class="co">#&gt; 1           0.01401836           0.01401836         2.253584         2.253584</span>
<span class="co">#&gt; 2          -0.10634799          -0.10634799         2.508288         2.508288</span>
<span class="co">#&gt; 3          -0.08299072          -0.08299072         2.671066         2.671066</span>
<span class="co">#&gt; 4          -0.09566747          -0.09566747         2.364474         2.364474</span>
<span class="co">#&gt; 5          -0.13594999          -0.13594999         2.489478         2.489478</span>
<span class="co">#&gt; 6           0.01879412           0.01879412         2.596936         2.596936</span>
<span class="co">#&gt;   gengamma.mu.TE.PFS</span>
<span class="co">#&gt; 1         -0.7365796</span>
<span class="co">#&gt; 2         -0.6860675</span>
<span class="co">#&gt; 3         -0.7229095</span>
<span class="co">#&gt; 4         -0.6495951</span>
<span class="co">#&gt; 5         -0.6892003</span>
<span class="co">#&gt; 6         -0.9693311</span></code></pre></div>
<p>The primary use of the bootstrap samples is to be used in probabilistic sensitivity analyses in economic models. Some basic statistics and diagnostics plots (histograms) can be used to summarise the bootstrap estimates and are presented below.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Summary of bootstrap values ----------------------------------------------</span>
<span class="co">#Re-format the data</span>
<span class="va">boot_gathered</span> <span class="op">&lt;-</span> <span class="va">PSM_boot_data</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span>key <span class="op">=</span> <span class="st">'parameter'</span>, value <span class="op">=</span> <span class="st">'value'</span><span class="op">)</span>

<span class="co">#calculate basic summary stats for all parameters</span>
<span class="va">boot_summ</span> <span class="op">&lt;-</span> <span class="va">boot_gathered</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">parameter</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span>.cols <span class="op">=</span> <span class="fu">where</span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span>,
                   <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
                     mean <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">.</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
                     sd <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">.</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
                     median <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">.</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
                     min <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">.</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
                     max <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">.</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
                   <span class="op">)</span>
                   <span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span>.cols <span class="op">=</span> <span class="fu">where</span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">.</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>, .keep <span class="op">=</span> <span class="st">'unused'</span><span class="op">)</span>
<span class="co">#&gt; `summarise()` ungrouping output (override with `.groups` argument)</span>
<span class="va">boot_summ</span>
<span class="co">#&gt; # A tibble: 70 x 6</span>
<span class="co">#&gt;    parameter        value_mean value_sd value_median value_min value_max</span>
<span class="co">#&gt;    &lt;chr&gt;                 &lt;dbl&gt;    &lt;dbl&gt;        &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt;  1 exp.rate.A.OS        -4.74     0.076        -4.74    -4.94     -4.55 </span>
<span class="co">#&gt;  2 exp.rate.A.PFS       -4.58     0.06         -4.59    -4.71     -4.41 </span>
<span class="co">#&gt;  3 exp.rate.B.OS        -5.87     0.076        -5.86    -6.05     -5.68 </span>
<span class="co">#&gt;  4 exp.rate.B.PFS       -5.27     0.071        -5.26    -5.44     -5.13 </span>
<span class="co">#&gt;  5 exp.rate.TE.OS        1.13     0.101         1.13     0.874     1.37 </span>
<span class="co">#&gt;  6 exp.rate.TE.PFS       0.692    0.087         0.69     0.491     0.885</span>
<span class="co">#&gt;  7 gamma.rate.A.OS      -4.75     0.108        -4.74    -4.96     -4.50 </span>
<span class="co">#&gt;  8 gamma.rate.A.PFS     -5.32     0.068        -5.32    -5.53     -5.18 </span>
<span class="co">#&gt;  9 gamma.rate.B.OS      -5.88     0.13         -5.87    -6.21     -5.58 </span>
<span class="co">#&gt; 10 gamma.rate.B.PFS     -6.44     0.152        -6.42    -6.77     -6.10 </span>
<span class="co">#&gt; # … with 60 more rows</span>
<span class="co">#Density plots for each parameter to show distribution</span>
<span class="co">#Could also be individual plots instead of faceted</span>
<span class="va">p_boot_density</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">boot_gathered</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_density</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_vline</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">value_mean</span><span class="op">)</span>, <span class="va">boot_summ</span>, colour <span class="op">=</span> <span class="st">'darkgreen'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_vline</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">value_median</span><span class="op">)</span>, <span class="va">boot_summ</span>, colour <span class="op">=</span> <span class="st">'blue'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">parameter</span>, scales <span class="op">=</span> <span class="st">'free'</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">p_boot_density</span><span class="op">)</span></code></pre></div>
<p><img src="Fitting_models_in_R_files/figure-html/unnamed-chunk-11-1.png" width="672"></p>
<p>#References</p>
<div id="refs" class="references">
<div id="ref-latimer2011nice">
<p>[1] Latimer N. NICE dsu technical support document 14: Survival analysis for economic evaluations alongside clinical trials-extrapolation with patient-level data. Sheffield: Report by the Decision Support Unit 2011;2013.</p>
</div>
<div id="ref-rutherford2020nice">
<p>[2] Rutherford MJ, Lambert PC, Sweeting MJ, Pennington B, Crowther MJ, Abrams KR, et al. NICE dsu technical support document 21: Flexible methods for survival analysis 2020.</p>
</div>
<div id="ref-cadth2020">
<p>[3] CADTH. Procedures for cadth drug reimbursement reviews 2020.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Iain Bennett, Jo Gregory, Sarah Smith, Richard Birnie.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
