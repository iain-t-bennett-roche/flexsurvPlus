<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PSA and correlated endpoints (bootstrap approch) • flexsurvPlus</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="PSA and correlated endpoints (bootstrap approch)">
<meta property="og:description" content="flexsurvPlus">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">flexsurvPlus</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Fitting_models_in_R.html">Fitting parametric survival models in R</a>
    </li>
    <li>
      <a href="../articles/Fitting_models_in_R_bootstrap.html">PSA and correlated endpoints (bootstrap approch)</a>
    </li>
    <li>
      <a href="../articles/Survival_analysis_theory.html">Parametric survival analysis using the flexsurvPlus package: understanding the theory</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Fitting_models_in_R_bootstrap_files/header-attrs-2.6/header-attrs.js"></script><script src="Fitting_models_in_R_bootstrap_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>PSA and correlated endpoints (bootstrap approch)</h1>
                        <h4 class="author">Roche</h4>
            
            <h4 class="date">2021-01-06</h4>
      
      
      <div class="hidden name"><code>Fitting_models_in_R_bootstrap.Rmd</code></div>

    </div>

    
    
<style type="text/css">

body{ /* Normal  */
      font-size: 14px;
  }
td {  /* Table  */
  font-size: 10px;
}
h1.title {
  font-size: 38px;
}
h1 { /* Header 1 */
  font-size: 28px;
  }
h2 { /* Header 2 */
    font-size: 22px;
}
h3 { /* Header 3 */
  font-size: 18px;
}
code.r{ /* Code block */
    font-size: 12px;
}
pre { /* Code block - determines code spacing between lines */
    font-size: 14px;
}
</style>
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>Parametric survival models are often the preferred method of extrapolating survival data for use in economic models. The National Institute for Health and Care Excellence (NICE) Decision Support Unit (DSU) technical support document (TSD) 14 recommends that the Exponential, Weibull, Gompertz, log-logistic, log normal and Generalized Gamma parametric models should all be considered.<span class="citation">[1]</span> More recently, NICE also discusses more flexible models in NICE DSU TSD 21, however, more these models are not in the scope of this package.<span class="citation">[2]</span> The Canadian Agency for Drugs and Technologies in Health (CADTH) additionally specifies that the Gamma distribution must also be considered. This document therefore details the characteristics of each of these distributions and demonstrates how the parameters from each distribution, outputted using the flexsurvPlus package, can be implemented within an economic model.<span class="citation">[3]</span></p>
</div>
<div id="handling-uncertainty" class="section level1">
<h1 class="hasAnchor">
<a href="#handling-uncertainty" class="anchor"></a>Handling uncertainty</h1>
<p>The flexsurvPlus package allows the handling of uncertainty in estimates primarily through boot strapping. This enables correlations between different endpoints to be preserved in the excel models. This vignette illustrates this with a simple example.</p>
</div>
<div id="set-up-packages-and-data" class="section level1">
<h1 class="hasAnchor">
<a href="#set-up-packages-and-data" class="anchor"></a>Set up packages and data</h1>
<div id="install-packages" class="section level2">
<h2 class="hasAnchor">
<a href="#install-packages" class="anchor"></a>Install packages</h2>
<p>The following packages are required to run this example:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">flexsurvPlus</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tibble</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">survival</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">boot</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'boot'</span>
<span class="co">#&gt; The following object is masked from 'package:survival':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     aml</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)</pre></body></html></div>
</div>
<div id="read-in-the-data" class="section level2">
<h2 class="hasAnchor">
<a href="#read-in-the-data" class="anchor"></a>Read in the data</h2>
<p>To perform survival analyses, patient level data is required for the survival endpoints.</p>
<p>This example uses a standard simulated data set (adtte). There is no standard naming that is needed for this package however, there are some set variables that are needed:</p>
<ul>
<li>Time - a numeric variable</li>
<li>Event - a binary variable (event=1, censor=0)</li>
<li>Treatment - a character variable with the name of the intervention treatment</li>
</ul>
<p>The data must be in “wide” format such that there is one row per patient and columns for each endpoint separately. In this example, we use overall survival (OS) and progression-free survival (PFS).</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r">

<span class="co"># simulate data with a medium correlation between PFS &amp; OS on the patient level</span>
<span class="no">adtte</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/sim_adtte.html">sim_adtte</a></span>(<span class="kw">seed</span> <span class="kw">=</span> <span class="fl">2020</span>, <span class="kw">rho</span> <span class="kw">=</span> <span class="fl">0.6</span>)

<span class="co"># subset OS data and rename</span>
<span class="no">OS_data</span> <span class="kw">&lt;-</span> <span class="no">adtte</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">PARAMCD</span><span class="kw">==</span><span class="st">"OS"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span>(<span class="no">USUBJID</span>,
            <span class="no">ARMCD</span>,
            <span class="kw">OS_days</span> <span class="kw">=</span> <span class="no">AVAL</span>,
            <span class="kw">OS_event</span> <span class="kw">=</span> <span class="fl">1</span>- <span class="no">CNSR</span>
  )

<span class="co"># subset PFS data and rename</span>
<span class="no">PFS_data</span> <span class="kw">&lt;-</span> <span class="no">adtte</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">PARAMCD</span><span class="kw">==</span><span class="st">"PFS"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span>(<span class="no">USUBJID</span>,
            <span class="no">ARMCD</span>,
            <span class="kw">PFS_days</span> <span class="kw">=</span> <span class="no">AVAL</span>,
            <span class="kw">PFS_event</span> <span class="kw">=</span> <span class="fl">1</span>- <span class="no">CNSR</span>
  )

<span class="no">analysis_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span>(<span class="no">OS_data</span>, <span class="no">PFS_data</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"USUBJID"</span>, <span class="st">"ARMCD"</span>))</pre></body></html></div>
</div>
</div>
<div id="bootstrapping-the-endpoints" class="section level1">
<h1 class="hasAnchor">
<a href="#bootstrapping-the-endpoints" class="anchor"></a>Bootstrapping the endpoints</h1>
<div id="ignoring-correlation-between-endpoints" class="section level2">
<h2 class="hasAnchor">
<a href="#ignoring-correlation-between-endpoints" class="anchor"></a>Ignoring correlation between endpoints</h2>
<p>Bootstrapping has been used to estimate the uncertainty of the parameters from the survival models for multiple endpoints at once to preserve the correlation between endpoints. In this example we have used OS and PFS. For speed of execution and illustration of concept we only fit a common shape weibull model for PFS and separate gamma models for OS here but all models discussed in <tt>runPSM</tt> could be specified with a single call.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r">

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">2358</span>)
<span class="no">n.sim</span> <span class="kw">&lt;-</span> <span class="fl">100</span>

<span class="no">PSM_bootstraps_PFS</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/boot/man/boot.html">boot</a></span>(
  <span class="kw">statistic</span> <span class="kw">=</span> <span class="no">bootPSM</span>, <span class="co"># bootstrap function</span>
  <span class="kw">R</span><span class="kw">=</span><span class="no">n.sim</span>, <span class="co"># number of bootstrap samples</span>
  <span class="kw">data</span><span class="kw">=</span><span class="no">analysis_data</span>,
  <span class="kw">time_var</span><span class="kw">=</span><span class="st">"PFS_days"</span>,
  <span class="kw">event_var</span><span class="kw">=</span><span class="st">"PFS_event"</span>,
  <span class="kw">model.type</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Common shape"</span>),
  <span class="kw">distr</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'weibull'</span>),
  <span class="kw">strata_var</span> <span class="kw">=</span> <span class="st">"ARMCD"</span>,
  <span class="kw">int_name</span><span class="kw">=</span><span class="st">"B"</span>,
  <span class="kw">ref_name</span> <span class="kw">=</span> <span class="st">"A"</span>
)

<span class="no">PSM_bootstraps_OS</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/boot/man/boot.html">boot</a></span>(
  <span class="kw">statistic</span> <span class="kw">=</span> <span class="no">bootPSM</span>, <span class="co"># bootstrap function</span>
  <span class="kw">R</span><span class="kw">=</span><span class="no">n.sim</span>, <span class="co"># number of bootstrap samples</span>
  <span class="kw">data</span><span class="kw">=</span><span class="no">analysis_data</span>,
  <span class="kw">time_var</span><span class="kw">=</span><span class="st">"OS_days"</span>,
  <span class="kw">event_var</span><span class="kw">=</span><span class="st">"OS_event"</span>,
  <span class="kw">model.type</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Separate"</span>),
  <span class="kw">distr</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'gamma'</span>),
  <span class="kw">strata_var</span> <span class="kw">=</span> <span class="st">"ARMCD"</span>,
  <span class="kw">int_name</span><span class="kw">=</span><span class="st">"B"</span>,
  <span class="kw">ref_name</span> <span class="kw">=</span> <span class="st">"A"</span>
)</pre></body></html></div>
<p>We can see these are using different bootstrap samples by looking at the bootstrap indexes. This is equiavlent to performing PSA for OS and PFS independently.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r">
<span class="no">index_PFS</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/boot/man/boot.array.html">boot.array</a></span>(<span class="no">PSM_bootstraps_PFS</span>, <span class="kw">indices</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="no">index_OS</span>  <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/boot/man/boot.array.html">boot.array</a></span>(<span class="no">PSM_bootstraps_OS</span>, <span class="kw">indices</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

<span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span>(<span class="no">index_OS</span> <span class="kw">==</span> <span class="no">index_PFS</span>)
<span class="co">#&gt; [1] FALSE</span></pre></body></html></div>
</div>
<div id="considering-correlation-between-endpoints" class="section level2">
<h2 class="hasAnchor">
<a href="#considering-correlation-between-endpoints" class="anchor"></a>Considering correlation between endpoints</h2>
<p>If we want to maintain correlations between PFS and OS we need to use the same bootstrap samples for both the PFS and OS analysis. The easiest way to do this is to reuse the same seed before calling the boot function for the second endpoint.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r">
<span class="no">n.sim</span> <span class="kw">&lt;-</span> <span class="fl">100</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">2020</span>)

<span class="no">PSM_bootstraps_PFScor</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/boot/man/boot.html">boot</a></span>(
  <span class="kw">statistic</span> <span class="kw">=</span> <span class="no">bootPSM</span>, <span class="co"># bootstrap function</span>
  <span class="kw">R</span><span class="kw">=</span><span class="no">n.sim</span>, <span class="co"># number of bootstrap samples</span>
  <span class="kw">data</span><span class="kw">=</span><span class="no">analysis_data</span>,
  <span class="kw">time_var</span><span class="kw">=</span><span class="st">"PFS_days"</span>,
  <span class="kw">event_var</span><span class="kw">=</span><span class="st">"PFS_event"</span>,
  <span class="kw">model.type</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Common shape"</span>),
  <span class="kw">distr</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'weibull'</span>),
  <span class="kw">strata_var</span> <span class="kw">=</span> <span class="st">"ARMCD"</span>,
  <span class="kw">int_name</span><span class="kw">=</span><span class="st">"B"</span>,
  <span class="kw">ref_name</span> <span class="kw">=</span> <span class="st">"A"</span>
)

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">2020</span>)

<span class="no">PSM_bootstraps_OScor</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/boot/man/boot.html">boot</a></span>(
  <span class="kw">statistic</span> <span class="kw">=</span> <span class="no">bootPSM</span>, <span class="co"># bootstrap function</span>
  <span class="kw">R</span><span class="kw">=</span><span class="no">n.sim</span>, <span class="co"># number of bootstrap samples</span>
  <span class="kw">data</span><span class="kw">=</span><span class="no">analysis_data</span>,
  <span class="kw">time_var</span><span class="kw">=</span><span class="st">"OS_days"</span>,
  <span class="kw">event_var</span><span class="kw">=</span><span class="st">"OS_event"</span>,
  <span class="kw">model.type</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Separate"</span>),
  <span class="kw">distr</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'gamma'</span>),
  <span class="kw">strata_var</span> <span class="kw">=</span> <span class="st">"ARMCD"</span>,
  <span class="kw">int_name</span><span class="kw">=</span> <span class="st">"B"</span>,
  <span class="kw">ref_name</span> <span class="kw">=</span> <span class="st">"A"</span>
)</pre></body></html></div>
<p>We can check these are indeed using the same bootstrap samples by comparing the indexes selected. This means the associated bootstrap distributions for PFS and OS remain correlated.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r">
<span class="no">index_PFScor</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/boot/man/boot.array.html">boot.array</a></span>(<span class="no">PSM_bootstraps_PFScor</span>, <span class="kw">indices</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="no">index_OScor</span>  <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/boot/man/boot.array.html">boot.array</a></span>(<span class="no">PSM_bootstraps_OScor</span>, <span class="kw">indices</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

<span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span>(<span class="no">index_OScor</span> <span class="kw">==</span> <span class="no">index_PFScor</span>)
<span class="co">#&gt; [1] TRUE</span></pre></body></html></div>
</div>
<div id="plotting-impact-of-accounting-for-correlations-between-endpoints" class="section level2">
<h2 class="hasAnchor">
<a href="#plotting-impact-of-accounting-for-correlations-between-endpoints" class="anchor"></a>Plotting impact of accounting for correlations between endpoints</h2>
<p>The primary use of the bootstrap samples is to be used in probabilistic sensitivity analyses (PSA) in economic models. To illustrate the impact of accounting for correlations between each endpoint in such PSA we will look at plotting the difference between the extrapolated mean PFS and mean OS. To do this we need to calculate the mean PFS and mean OS for the reference and intervention arm for each sample.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r">
<span class="no">os_means</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span>(
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="fu"><a href="../reference/bootPSMtidy.html">bootPSMtidy</a></span>(<span class="no">PSM_bootstraps_OS</span>), <span class="kw">Bootstrap</span> <span class="kw">=</span> <span class="st">"Uncorrelated"</span>),
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="fu"><a href="../reference/bootPSMtidy.html">bootPSMtidy</a></span>(<span class="no">PSM_bootstraps_OScor</span>), <span class="kw">Bootstrap</span> <span class="kw">=</span> <span class="st">"Correlated"</span>)
  ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span>(<span class="no">SampleID</span>, <span class="no">Bootstrap</span>,
    <span class="kw">os_mean_time_ref</span> <span class="kw">=</span> <span class="kw pkg">flexsurv</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/flexsurv/man/means.html">mean_gamma</a></span>(<span class="kw">shape</span> <span class="kw">=</span> <span class="no">gamma.shape.ref</span>, <span class="kw">rate</span> <span class="kw">=</span> <span class="no">gamma.rate.ref</span>),
    <span class="kw">os_mean_time_int</span> <span class="kw">=</span> <span class="kw pkg">flexsurv</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/flexsurv/man/means.html">mean_gamma</a></span>(<span class="kw">shape</span> <span class="kw">=</span> <span class="no">gamma.shape.int</span>, <span class="kw">rate</span> <span class="kw">=</span> <span class="no">gamma.rate.int</span>),
    <span class="kw">os_mean_delta</span> <span class="kw">=</span> <span class="no">os_mean_time_int</span> - <span class="no">os_mean_time_ref</span>
  )

<span class="no">pfs_means</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span>(
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="fu"><a href="../reference/bootPSMtidy.html">bootPSMtidy</a></span>(<span class="no">PSM_bootstraps_PFS</span>), <span class="kw">Bootstrap</span> <span class="kw">=</span> <span class="st">"Uncorrelated"</span>),
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="fu"><a href="../reference/bootPSMtidy.html">bootPSMtidy</a></span>(<span class="no">PSM_bootstraps_PFScor</span>), <span class="kw">Bootstrap</span> <span class="kw">=</span> <span class="st">"Correlated"</span>)
  ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span>(<span class="no">SampleID</span>, <span class="no">Bootstrap</span>,
            <span class="kw">pfs_mean_time_ref</span> <span class="kw">=</span> <span class="kw pkg">flexsurv</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/flexsurv/man/means.html">mean_weibull</a></span>(<span class="kw">shape</span> <span class="kw">=</span> <span class="no">weibull.shape.ref</span>, <span class="kw">scale</span> <span class="kw">=</span> <span class="no">weibull.scale.ref</span>),
            <span class="kw">pfs_mean_time_int</span> <span class="kw">=</span> <span class="kw pkg">flexsurv</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/flexsurv/man/means.html">mean_weibull</a></span>(<span class="kw">shape</span> <span class="kw">=</span> <span class="no">weibull.shape.int</span>, <span class="kw">scale</span> <span class="kw">=</span> <span class="no">weibull.scale.int</span>),
            <span class="kw">pfs_mean_delta</span> <span class="kw">=</span> <span class="no">pfs_mean_time_int</span> - <span class="no">pfs_mean_time_ref</span>
  )


<span class="no">mean_durations</span> <span class="kw">&lt;-</span> <span class="no">pfs_means</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span>(<span class="no">os_means</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"SampleID"</span>, <span class="st">"Bootstrap"</span>))

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">mean_durations</span>)
<span class="co">#&gt; # A tibble: 6 x 8</span>
<span class="co">#&gt;   SampleID Bootstrap pfs_mean_time_r… pfs_mean_time_i… pfs_mean_delta</span>
<span class="co">#&gt;      &lt;int&gt; &lt;chr&gt;                &lt;dbl&gt;            &lt;dbl&gt;          &lt;dbl&gt;</span>
<span class="co">#&gt; 1        0 Uncorrel…             206.             399.           193.</span>
<span class="co">#&gt; 2        1 Uncorrel…             210.             414.           204.</span>
<span class="co">#&gt; 3        2 Uncorrel…             233.             419.           186.</span>
<span class="co">#&gt; 4        3 Uncorrel…             204.             387.           183.</span>
<span class="co">#&gt; 5        4 Uncorrel…             212.             346.           134.</span>
<span class="co">#&gt; 6        5 Uncorrel…             219.             420.           201.</span>
<span class="co">#&gt; # … with 3 more variables: os_mean_time_ref &lt;dbl&gt;, os_mean_time_int &lt;dbl&gt;,</span>
<span class="co">#&gt; #   os_mean_delta &lt;dbl&gt;</span></pre></body></html></div>
<p>We can now plot this dataset and as expected the correlated bootstrap approach leads to mean estimates for PFS and OS that preserve the correlations in the underlying data. Here we use all bootstrap samples but in the context of an excel economic we would perform PSA by randomly sampling SampleIDs and using the same SampleID for both PFS and OS in a single PSA run.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r">
<span class="no">mean_durations</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">pfs_mean_delta</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">os_mean_delta</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="no">Bootstrap</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_ellipse.html">stat_ellipse</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span>(<span class="kw">xlim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">100</span>, <span class="fl">300</span>), <span class="kw">ylim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">2500</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span>(<span class="st">"Difference in mean (weibull) PFS (B vs A)"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span>(<span class="st">"Difference in mean (gamma) OS (B vs A)"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Each point is a bootstrap sample"</span>)</pre></body></html></div>
<p><img src="Fitting_models_in_R_bootstrap_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
<p>#References</p>
<div id="refs" class="references">
<div id="ref-latimer2011nice">
<p>[1] Latimer N. NICE dsu technical support document 14: Survival analysis for economic evaluations alongside clinical trials-extrapolation with patient-level data. Sheffield: Report by the Decision Support Unit 2011;2013.</p>
</div>
<div id="ref-rutherford2020nice">
<p>[2] Rutherford MJ, Lambert PC, Sweeting MJ, Pennington B, Crowther MJ, Abrams KR, et al. NICE dsu technical support document 21: Flexible methods for survival analysis 2020.</p>
</div>
<div id="ref-cadth2020">
<p>[3] CADTH. Procedures for cadth drug reimbursement reviews 2020.</p>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Iain Bennett, Jo Gregory, Sarah Smith, Richard Birnie.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
